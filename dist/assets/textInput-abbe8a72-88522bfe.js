import{z as ee,u as ye,r as i,R as Ce,e as ke,C as ie,g as ue,j as n,a as Re,M as we,F as G,b as Ve,c as _e,d as je,f as Ne}from"./index-2b5c64d9.js";import{i as se}from"./css-ab4d83ca-d016d639.js";import{BoardContext as Ee}from"./graph-6d43a295-5c8ba528.js";const j=ee.button`
  position: relative;
  height: 24px;
  width: 24px;
  display: inline-block;
  color: white;
  background-color: var(--mainBlue);
  padding: 2px;
  /* border: var(--mainBorder); */
  border: none;
  border-radius: var(--mainBorderRadius);
  margin: 0px 4px 4px 0px;

  &:hover {
    background-color: var(--lightBlue);
    color: black;
  }
`,Ie=ee.textarea`
  width: ${s=>s.width};
  height: ${s=>s.height}; // Same height as the checkWorkButton, accounting for the borders
  font-size: 14px;
  border: ${s=>s.disabled?"2px solid var(--mainGray)":"var(--mainBorder)"};
  cursor: ${s=>s.disabled?"not-allowed":"auto"};

  &:focus {
    outline: var(--mainBorder);
    outline-offset: 2px;
  }
`,Ae=ee.input`
  width: ${s=>s.width};
  height: 20px; // Same height as the checkWorkButton, accounting for the borders
  font-size: 14px;
  border: ${s=>s.disabled?"2px solid var(--mainGray)":"var(--mainBorder)"};
  cursor: ${s=>s.disabled?"not-allowed":"auto"};

  &:focus {
    outline: var(--mainBorder);
    outline-offset: 2px;
  }
`;function ce(s){let{name:Be,id:h,SVs:e,actions:p,sourceOfUpdate:Le,ignoreUpdate:le,rendererName:de,callAction:m}=ye(s),N=se(e.width),pe=se(e.height);ce.baseStateVariable="immediateValue",ce.ignoreActionsWithoutCore=t=>t==="moveInput";const[R,W]=i.useState(e.immediateValue);let C=i.useRef(null);C.current=R;const me=Ce(ke(de));let E=i.useRef(e.immediateValue),re=i.useRef(null),w=i.useRef(null),r=i.useRef(null),I=i.useRef(null),A=i.useRef(null);const c=i.useContext(Ee);let V=i.useRef(!1),X=i.useRef(!1),x=i.useRef(!1),v=i.useRef(null),b=i.useRef(null),te=i.useRef(null),Y=i.useRef(null),J=i.useRef(!1),_=i.useRef(!1);J.current=e.fixed,_.current=!e.draggable||e.fixLocation||e.fixed,i.useEffect(()=>()=>{r.current!==null&&xe()},[]),!le&&w.current!==e.immediateValue?(W(e.immediateValue),w.current=e.immediateValue,E.current=e.immediateValue):w.current=null;let k="unvalidated";e.valueHasBeenValidated&&(e.creditAchieved===1?k="correct":e.creditAchieved===0?k="incorrect":k="partialcorrect");function B(t){t.key==="Enter"&&(E.current=C.current,m({action:p.updateValue,baseVariableValue:C.current}),e.includeCheckWork&&!e.suppressCheckwork&&!e.expanded&&k==="unvalidated"&&m({action:p.submitAnswer}))}function L(t){if(t.key==="Escape"){let o=E.current;o!==C.current&&(W(o),w.current=e.immediateValue,m({action:p.updateImmediateValue,args:{text:o},baseVariableValue:o}))}}function F(t){re.current=!0}function S(t){re.current=!1,E.current=C.current,m({action:p.updateValue,baseVariableValue:C.current})}function P(t){let o=t.target.value;o!==C.current&&(W(o),me(f=>{let g={...f};return g.ignoreUpdate=!0,g}),w.current=e.immediateValue,m({action:p.updateImmediateValue,args:{text:o},baseVariableValue:o}))}function he(){let t={visible:!e.hidden,fixed:J.current,disabled:e.disabled,useMathJax:e.labelHasLatex,strokeColor:"var(--canvastext)",highlightStrokeColor:"var(--canvastext)",highlight:!_.current,parse:!1},o;try{let u=ie.fromAst(e.anchor),y=[u.get_component(0).evaluate_to_constant(),u.get_component(1).evaluate_to_constant()];Number.isFinite(y[0])||(y[0]=0,t.visible=!1),Number.isFinite(y[1])||(y[1]=0,t.visible=!1),o=c.create("point",y,{visible:!1})}catch{t.visible=!1,o=c.create("point",[0,0],{visible:!1});return}t.anchor=o;let{anchorx:f,anchory:g}=ue(e.positionFromAnchor);t.anchorx=f,t.anchory=g,A.current=[f,g];let a=c.create("input",[0,0,R,e.label],t);a.isDraggable=!_.current,a.rendNodeInput.addEventListener("input",P),a.rendNodeInput.addEventListener("keypress",B),a.rendNodeInput.addEventListener("keydown",L),a.rendNodeInput.addEventListener("blur",S),a.rendNodeInput.addEventListener("focus",F),a.rendNodeInput.style.width=N,a.rendNodeInput.style.color="var(--canvastext)",a.rendNodeInput.style.background="var(--canvas)",a.rendNodeInput.style.borderColor="var(--canvastext)",a.rendNodeLabel.style.marginRight="2px",a.on("down",function(u){V.current=[u.x,u.y],X.current=[...o.coords.scrCoords],x.current=!1}),a.on("hit",function(u){x.current=!1}),a.on("up",function(u){x.current&&(m({action:p.moveInput,args:{x:v.current,y:b.current}}),x.current=!1)}),a.on("keyfocusout",function(u){x.current&&(m({action:p.moveInput,args:{x:v.current,y:b.current}}),x.current=!1)}),a.on("drag",function(u){let y=u.type==="pointermove";(!y||Math.abs(u.x-V.current[0])>.1||Math.abs(u.y-V.current[1])>.1)&&(x.current=!0);let[K,T,H,q]=c.getBoundingBox(),Q=a.size[0]/c.unitX,Z=a.size[1]/c.unitY,ne=A.current[0],oe=A.current[1],$=0;ne==="middle"?$=-Q/2:ne==="right"&&($=-Q);let O=0;oe==="middle"?O=-Z/2:oe==="top"&&(O=-Z);let fe=K+.04*(H-K)-$-Q,ve=H-.04*(H-K)-$,be=q+.04*(T-q)-O-Z,ge=T-.04*(T-q)-O;if(y){var ae=c.origin.scrCoords;v.current=(X.current[1]+u.x-V.current[0]-ae[1])/c.unitX,b.current=(ae[2]-(X.current[2]+u.y-V.current[1]))/c.unitY}else v.current=o.X()+a.relativeCoords.usrCoords[1],b.current=o.Y()+a.relativeCoords.usrCoords[2];v.current=Math.min(ve,Math.max(fe,v.current)),b.current=Math.min(ge,Math.max(be,b.current)),m({action:p.moveInput,args:{x:v.current,y:b.current,transient:!0,skippable:!0}}),a.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),o.coords.setCoordinates(JXG.COORDS_BY_USER,te.current)}),a.on("keydown",function(u){u.key==="Enter"&&x.current&&(m({action:p.moveInput,args:{x:v.current,y:b.current}}),x.current=!1)}),r.current=a,I.current=o,Y.current=e.positionFromAnchor,e.labelHasLatex&&setTimeout(()=>{r.current&&(r.current.needsUpdate=!0,r.current.setText(e.label),r.current.update(),c==null||c.updateRenderer())},1e3)}function xe(){r.current.rendNodeInput.removeEventListener("input",P),r.current.rendNodeInput.removeEventListener("keypress",B),r.current.rendNodeInput.removeEventListener("keydown",L),r.current.rendNodeInput.removeEventListener("blur",S),r.current.rendNodeInput.removeEventListener("focus",F),r.current.off("drag"),r.current.off("down"),r.current.off("hit"),r.current.off("up"),r.current.off("keyfocusout"),r.current.off("keydown"),c.removeObject(r.current),r.current=null}if(c){let t;try{let o=ie.fromAst(e.anchor);t=[o.get_component(0).evaluate_to_constant(),o.get_component(1).evaluate_to_constant()]}catch{t=[NaN,NaN]}if(te.current=t,r.current===null)he();else{r.current.Value()!==R&&r.current.set(R),r.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),I.current.coords.setCoordinates(JXG.COORDS_BY_USER,t),r.current.setText(e.label),r.current.rendNodeInput.style.width=N;let o=!e.hidden;if(Number.isFinite(t[0])&&Number.isFinite(t[1])){let f=r.current.visProp.visible!==o;r.current.visProp.visible=o,r.current.visPropCalc.visible=o,f&&r.current.setAttribute({visible:o})}else r.current.visProp.visible=!1,r.current.visPropCalc.visible=!1;if(r.current.visProp.disabled!==e.disabled&&(r.current.visProp.disabled=e.disabled,r.current.setAttribute({disabled:e.disabled})),r.current.visProp.highlight=!_.current,r.current.visProp.fixed=J.current,r.current.isDraggable=!_.current,r.current.needsUpdate=!0,e.positionFromAnchor!==Y.current){let{anchorx:f,anchory:g}=ue(e.positionFromAnchor);r.current.visProp.anchorx=f,r.current.visProp.anchory=g,A.current=[f,g],Y.current=e.positionFromAnchor,r.current.fullUpdate()}else r.current.update();I.current.needsUpdate=!0,I.current.update(),c.updateRenderer()}return n.jsx("a",{name:h})}if(e.hidden)return null;let U=e.disabled;const D=h+"_input";let l={cursor:"pointer",padding:"1px 6px 1px 6px"};U&&(l.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),l.cursor="not-allowed",l.color="black");let d=null;if(e.includeCheckWork&&!e.suppressCheckwork){if(k==="unvalidated")d=n.jsx(j,{id:h+"_submit",tabIndex:"0",disabled:U,style:l,onClick:()=>m({action:p.submitAnswer}),onKeyPress:t=>{t.key==="Enter"&&m({action:p.submitAnswer})},children:n.jsx(G,{style:{},icon:Ve,transform:{rotate:90}})});else if(e.showCorrectness)if(k==="correct")l.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--mainGreen"),d=n.jsx(j,{id:h+"_correct",style:l,children:n.jsx(G,{icon:_e})});else if(k==="partialcorrect"){let t=`${Math.round(e.creditAchieved*100)} %`;l.width="44px",l.backgroundColor="#efab34",d=n.jsx(j,{id:h+"_partial",style:l,children:t})}else l.backgroundColor=getComputedStyle(document.documentElement).getPropertyValue("--mainRed"),d=n.jsx(j,{id:h+"_incorrect",style:l,children:n.jsx(G,{icon:je})});else l.backgroundColor="rgb(74, 3, 217)",l.padding="1px 8px 1px 4px",d=n.jsx(j,{id:h+"_saved",style:l,children:n.jsx(G,{icon:Ne})});e.numAttemptsLeft<0?d=n.jsxs(n.Fragment,{children:[d,n.jsx("span",{children:"(no attempts remaining)"})]}):e.numAttemptsLeft==1?d=n.jsxs(n.Fragment,{children:[d,n.jsx("span",{children:"(1 attempt remaining)"})]}):Number.isFinite(e.numAttemptsLeft)&&(d=n.jsxs(n.Fragment,{children:[d,n.jsxs("span",{children:["(attempts remaining: ",e.numAttemptsLeft,")"]})]}))}let z,M=e.label;return e.labelHasLatex&&(M=n.jsx(Re,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:M})),e.expanded?z=n.jsxs("label",{style:{display:"inline-flex",maxWidth:"100%"},children:[M,n.jsx(Ie,{id:D,value:R,disabled:U,onChange:P,onKeyPress:B,onKeyDown:L,onBlur:S,onFocus:F,width:N,height:pe,style:{margin:"0px 4px 4px 4px",color:"var(--canvastext)",background:"var(--canvas)"}},D)]}):z=n.jsxs("label",{style:{display:"inline-flex",maxWidth:"100%"},children:[M,n.jsx(Ae,{id:D,value:R,disabled:U,onChange:P,onKeyPress:B,onKeyDown:L,onBlur:S,onFocus:F,width:N,style:{margin:"0px 4px 4px 4px",color:"var(--canvastext)",background:"var(--canvas)"}},D)]}),n.jsxs(we.Fragment,{children:[n.jsx("a",{name:h}),n.jsxs("span",{className:"textInputSurroundingBox",id:h,style:{display:"inline-flex",maxWidth:"100%"},children:[z,d]})]})}export{ce as default};
