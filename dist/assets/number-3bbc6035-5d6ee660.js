import{M as oe,u as ce,r as n,h as ue,i as se,C as q,g as Q,j as b,t as ie,a as ae}from"./index-2b5c64d9.js";import{BoardContext as le,TEXT_LAYER_OFFSET as W}from"./graph-6d43a295-5c8ba528.js";import"./css-ab4d83ca-d016d639.js";const pe=oe.memo(function Z(H){let{name:S,id:O,SVs:r,actions:d,sourceOfUpdate:de,callAction:f}=ce(H);Z.ignoreActionsWithoutCore=()=>!0;let e=n.useRef(null),_=n.useRef(null),P=n.useRef(null);const t=n.useContext(le);let y=n.useRef(!1),M=n.useRef(!1),E=n.useRef(!1),N=n.useRef(!1),l=n.useRef(!1),h=n.useRef(null),m=n.useRef(null),w=n.useRef(null),D=n.useRef(null),C=n.useRef(!1),k=n.useRef(!1);C.current=r.fixed,k.current=!r.draggable||r.fixLocation||r.fixed;const R=ue(se);n.useEffect(()=>()=>{e.current!==null&&K(),t&&t.off("move",G)},[]),n.useEffect(()=>{t&&t.on("move",G)},[t]);function I(){let u=R==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,a=R==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,x="";a&&(x+=`background-color: ${a}`);let i={visible:!r.hidden,fixed:C.current,layer:10*r.layer+W,cssStyle:x,highlightCssStyle:x,strokeColor:u,strokeOpacity:1,highlightStrokeColor:u,highlightStrokeOpacity:.5,highlight:!k.current,parse:!1},s;try{let c=q.fromAst(r.anchor),g=[c.get_component(0).evaluate_to_constant(),c.get_component(1).evaluate_to_constant()];Number.isFinite(g[0])||(g[0]=0,i.visible=!1),Number.isFinite(g[1])||(g[1]=0,i.visible=!1),s=t.create("point",g,{visible:!1})}catch{i.visible=!1,s=t.create("point",[0,0],{visible:!1})}i.anchor=s;let{anchorx:p,anchory:v}=Q(r.positionFromAnchor);i.anchorx=p,i.anchory=v,P.current=[p,v];let o=t.create("text",[0,0,r.text],i);o.isDraggable=!k.current,o.on("down",function(c){y.current=[c.x,c.y],M.current=[...s.coords.scrCoords],l.current=!1,E.current=!0,N.current=!1,C.current||f({action:d.numberFocused,args:{name:S}})}),o.on("hit",function(c){M.current=[...s.coords.scrCoords],l.current=!1,f({action:d.numberFocused,args:{name:S}})}),o.on("up",function(c){l.current?(f({action:d.moveNumber,args:{x:h.current,y:m.current}}),l.current=!1):!N.current&&!C.current&&f({action:d.numberClicked,args:{name:S}}),E.current=!1}),o.on("keyfocusout",function(c){l.current&&(f({action:d.moveNumber,args:{x:h.current,y:m.current}}),l.current=!1)}),o.on("drag",function(c){let g=c.type==="pointermove";(!g||Math.abs(c.x-y.current[0])>.1||Math.abs(c.y-y.current[1])>.1)&&(l.current=!0);let[j,B,X,Y]=t.getBoundingBox(),J=o.size[0]/t.unitX,T=o.size[1]/t.unitY,z=P.current[0],L=P.current[1],A=0;z==="middle"?A=-J/2:z==="right"&&(A=-J);let F=0;L==="middle"?F=-T/2:L==="top"&&(F=-T);let ee=j+.04*(X-j)-A-J,re=X-.04*(X-j)-A,te=Y+.04*(B-Y)-F-T,ne=B-.04*(B-Y)-F;if(g){var $=t.origin.scrCoords;h.current=(M.current[1]+c.x-y.current[0]-$[1])/t.unitX,m.current=($[2]-(M.current[2]+c.y-y.current[1]))/t.unitY}else h.current=s.X()+o.relativeCoords.usrCoords[1],m.current=s.Y()+o.relativeCoords.usrCoords[2];h.current=Math.min(re,Math.max(ee,h.current)),m.current=Math.min(ne,Math.max(te,m.current)),f({action:d.moveNumber,args:{x:h.current,y:m.current,transient:!0,skippable:!0}}),o.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),s.coords.setCoordinates(JXG.COORDS_BY_USER,w.current)}),o.on("keydown",function(c){c.key==="Enter"&&(l.current&&(f({action:d.moveNumber,args:{x:h.current,y:m.current}}),l.current=!1),f({action:d.numberClicked,args:{name:S}}))}),e.current=o,_.current=s,D.current=r.positionFromAnchor}function G(u){E.current&&(Math.abs(u.x-y.current[0])>.1||Math.abs(u.y-y.current[1])>.1)&&(N.current=!0)}function K(){e.current.off("drag"),e.current.off("down"),e.current.off("hit"),e.current.off("up"),e.current.off("keyfocusout"),e.current.off("keydown"),t.removeObject(e.current),e.current=null}if(t){let u;try{let a=q.fromAst(r.anchor);u=[a.get_component(0).evaluate_to_constant(),a.get_component(1).evaluate_to_constant()]}catch{u=[NaN,NaN]}if(w.current=u,e.current===null)I();else{e.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),_.current.coords.setCoordinates(JXG.COORDS_BY_USER,u),e.current.setText(r.text);let a=!r.hidden;if(Number.isFinite(u[0])&&Number.isFinite(u[1])){let v=e.current.visProp.visible!==a;e.current.visProp.visible=a,e.current.visPropCalc.visible=a,v&&e.current.setAttribute({visible:a})}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1;let x=10*r.layer+W;e.current.visProp.layer!==x&&e.current.setAttribute({layer:x});let i=R==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,s=R==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,p="";if(s?p+=`background-color: ${s}`:p+="background-color: transparent",e.current.visProp.strokecolor!==i&&(e.current.visProp.strokecolor=i,e.current.visProp.highlightstrokecolor=i),e.current.visProp.cssstyle!==p&&(e.current.visProp.cssstyle=p,e.current.visProp.highlightcssstyle=p),e.current.visProp.highlight=!k.current,e.current.visProp.fixed=C.current,e.current.isDraggable=!k.current,e.current.needsUpdate=!0,r.positionFromAnchor!==D.current){let{anchorx:v,anchory:o}=Q(r.positionFromAnchor);e.current.visProp.anchorx=v,e.current.visProp.anchory=o,P.current=[v,o],D.current=r.positionFromAnchor,e.current.fullUpdate()}else e.current.update();_.current.needsUpdate=!0,_.current.update(),t.updateRenderer()}return b.jsx("a",{name:O})}if(r.hidden)return null;let U=r.text;r.renderAsMath&&(U="\\("+U+"\\)");let V=ie(R,r.selectedStyle);return b.jsxs(b.Fragment,{children:[b.jsx("a",{name:O}),b.jsx("span",{id:O,style:V,children:b.jsx(ae,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:U})})]})});export{pe as default};
