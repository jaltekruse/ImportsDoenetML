import{M as de,u as fe,r as c,h as he,i as ve,j as G,t as ye,a as be}from"./index-2b5c64d9.js";import{BoardContext as me,POINT_LAYER_OFFSET as ee}from"./graph-6d43a295-5c8ba528.js";import{v as ge,L as re,C as te,Y as ne,q as ce}from"./offGraphIndicators-6eabeb84-d9cfe74c.js";import"./css-ab4d83ca-d016d639.js";const Re=de.memo(function oe(ie){var K,Q;let{name:A,id:z,SVs:r,actions:a,sourceOfUpdate:xe,callAction:s}=fe(ie);oe.ignoreActionsWithoutCore=()=>!0;const n=c.useContext(me);let e=c.useRef(null),t=c.useRef(null),O=c.useRef(null),J=c.useRef(null),$=c.useRef(!1),N=c.useRef(!1),h=c.useRef(!1),T=c.useRef(null),W=c.useRef(null),k=c.useRef(null),S=c.useRef(null),p=c.useRef(null),B=c.useRef([0,0]),M=c.useRef([0,0]),U=c.useRef(!1),C=c.useRef(!1),H=c.useRef(!1);U.current=r.fixed,C.current=!r.draggable||r.fixLocation||r.fixed,H.current=r.switchable&&!r.fixed;const q=he(ve),Y=r.open||["cross","plus"].includes(r.selectedStyle.markerStyle);c.useEffect(()=>()=>{e.current!==null&&(t.current.off("drag"),t.current.off("down"),t.current.off("hit"),t.current.off("up"),t.current.off("keyfocusout"),t.current.off("keydown"),n.removeObject(e.current),n.removeObject(t.current),e.current=null,t.current=null),n&&n.off("move",Z)},[]),c.useEffect(()=>{n&&n.on("move",Z)},[n]);function le(){let v=q==="dark"?r.selectedStyle.markerColorDarkMode:r.selectedStyle.markerColor,X=Y?"var(--canvas)":v,w=Y?v:"none",x=r.labelForGraph!=="",i={name:r.labelForGraph,visible:!r.hidden,withlabel:x,fixed:!0,layer:10*r.layer+ee,fillColor:X,strokeColor:w,strokeOpacity:r.selectedStyle.markerOpacity,fillOpacity:r.selectedStyle.markerOpacity,highlightFillColor:"var(--mainGray)",highlightStrokeColor:"var(--lightBlue)",size:te(r.selectedStyle.markerSize,r.selectedStyle.markerStyle),face:re(r.selectedStyle.markerStyle,B.current),highlight:!C.current};if(x){let o=ne(r.labelPosition,M.current);W.current=o;let{offset:D,anchorx:j,anchory:y}=ce(o);i.label={offset:D,anchorx:j,anchory:y,highlight:!1},r.labelHasLatex&&(i.label.useMathJax=!0),r.applyStyleToLabel?i.label.strokeColor=v:i.label.strokeColor="var(--canvastext)"}else i.label={highlight:!1},r.labelHasLatex&&(i.label.useMathJax=!0);C.current?i.showInfoBox=!1:i.showInfoBox=r.showCoordsWhenDragging;let d=[p.current[0],p.current[1]];Number.isFinite(d[0])||(d[0]=0,i.visible=!1),Number.isFinite(d[1])||(d[1]=0,i.visible=!1);let f={...i};f.fixed=U.current,f.showInfoBox=!1,f.withlabel=!1,f.fillOpacity=0,f.strokeOpacity=0,f.highlightFillOpacity=0,f.highlightStrokeOpacity=0;let l=n.create("point",d,f);l.isDraggable=!C.current;let L=n.create("point",d,i);l.on("down",function(o){O.current=[o.x,o.y],J.current=[...l.coords.scrCoords],h.current=!1,t.current.visProp.highlightfillopacity=e.current.visProp.fillopacity,t.current.visProp.highlightstrokeopacity=e.current.visProp.strokeopacity,$.current=!0,N.current=!1,U.current||s({action:a.pointFocused,args:{name:A}})}),l.on("hit",function(o){h.current=!1,s({action:a.pointFocused,args:{name:A}})}),l.on("up",function(o){h.current?(s({action:a.movePoint,args:{x:k.current,y:S.current}}),h.current=!1):!N.current&&!U.current&&(H.current?(s({action:a.switchPoint}),s({action:a.pointClicked,args:{name:A}})):s({action:a.pointClicked,args:{name:A}})),$.current=!1,t.current.visProp.highlightfillopacity=0,t.current.visProp.highlightstrokeopacity=0}),l.on("hit",function(o){n.updateInfobox(e.current)}),l.on("keyfocusout",function(o){h.current&&(s({action:a.movePoint,args:{x:k.current,y:S.current}}),h.current=!1)}),l.on("drag",function(o){let D=o.type==="pointermove";(!D||Math.abs(o.x-O.current[0])>.1||Math.abs(o.y-O.current[1])>.1)&&(h.current=!0);let[j,y,P,R]=n.getBoundingBox(),b=j,m=P,u=R,g=y;P<j&&([m,b]=[b,m]),y<R&&([g,u]=[u,g]);let E=m-b,I=g-u;if(m-=E*.01,b+=E*.01,g-=I*.01,u+=I*.01,D){var _=n.origin.scrCoords;k.current=(J.current[1]+o.x-O.current[0]-_[1])/n.unitX,S.current=(_[2]-(J.current[2]+o.y-O.current[1]))/n.unitY}else k.current=l.X(),S.current=l.Y();k.current=Math.min(m,Math.max(b,k.current)),S.current=Math.min(g,Math.max(u,S.current)),s({action:a.movePoint,args:{x:k.current,y:S.current,transient:!0,skippable:!0}});let F=Math.min(m,Math.max(b,l.X())),V=Math.min(g,Math.max(u,l.Y()));l.coords.setCoordinates(JXG.COORDS_BY_USER,[F,V]),L.coords.setCoordinates(JXG.COORDS_BY_USER,p.current),n.updateInfobox(L)}),l.on("keydown",function(o){o.key==="Enter"&&(h.current&&(s({action:a.movePoint,args:{x:k.current,y:S.current}}),h.current=!1),H.current?(s({action:a.switchPoint}),s({action:a.pointClicked,args:{name:A}})):s({action:a.pointClicked,args:{name:A}}))}),e.current=L,t.current=l,T.current=x}function Z(v){$.current&&(Math.abs(v.x-O.current[0])>.1||Math.abs(v.y-O.current[1])>.1)&&(N.current=!0)}if(n){if(p.current=[...r.numericalXs],B.current=[0,0],!r.hideOffGraphIndicator){let{needIndicator:y,indicatorCoords:P,indicatorSides:R}=ge(p.current,n);y&&(p.current=P,B.current=R)}M.current=[0,0];let v=!1,X=!1,[w,x,i,d]=n.getBoundingBox();i<w&&(v=!0,[i,w]=[w,i]),x<d&&(X=!0,[x,d]=[d,x]);let f=i-w,l=x-d,L=w+f*.05,o=i-f*.05,D=d+l*.05,j=x-l*.05;if(p.current[0]<L?M.current[0]=v?1:-1:p.current[0]>o&&(M.current[0]=v?-1:1),p.current[1]<D?M.current[1]=X?1:-1:p.current[1]>j&&(M.current[1]=X?-1:1),e.current===null)le();else{let y=q==="dark"?r.selectedStyle.markerColorDarkMode:r.selectedStyle.markerColor,P=Y?"var(--canvas)":y,R=Y?y:"none";e.current.visProp.fillcolor!==P&&(e.current.visProp.fillcolor=P);let b=(K=p.current)==null?void 0:K[0],m=(Q=p.current)==null?void 0:Q[1];e.current.coords.setCoordinates(JXG.COORDS_BY_USER,[b,m]),h.current||t.current.coords.setCoordinates(JXG.COORDS_BY_USER,[b,m]);let u=!r.hidden;if(Number.isFinite(b)&&Number.isFinite(m)){let F=e.current.visProp.visible!==u;e.current.visProp.visible=u,e.current.visPropCalc.visible=u,t.current.visProp.visible=u,t.current.visPropCalc.visible=u,F&&(e.current.setAttribute({visible:u}),t.current.setAttribute({visible:u}))}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1,t.current.visProp.visible=!1,t.current.visPropCalc.visible=!1;let g=10*r.layer+ee;e.current.visProp.layer!==g&&(e.current.setAttribute({layer:g}),t.current.setAttribute({layer:g})),e.current.visProp.highlight=!C.current,t.current.visProp.highlight=!C.current,t.current.visProp.fixed=U.current,t.current.isDraggable=!C.current,e.current.visProp.strokecolor!==R&&(e.current.visProp.strokecolor=R,t.current.visProp.strokecolor=R,e.current.visProp.fillColor=P,t.current.visProp.fillColor=P),e.current.visProp.strokeopacity!==r.selectedStyle.markerOpacity&&(e.current.visProp.strokeopacity=r.selectedStyle.markerOpacity,e.current.visProp.fillopacity=r.selectedStyle.markerOpacity);let E=re(r.selectedStyle.markerStyle,B.current);e.current.visProp.face!==E&&(e.current.setAttribute({face:E}),t.current.setAttribute({face:E}));let I=te(r.selectedStyle.markerSize,r.selectedStyle.markerStyle);e.current.visProp.size!==I&&(e.current.setAttribute({size:I}),t.current.setAttribute({size:I})),C.current||B.current[0]||B.current[1]?(e.current.visProp.showinfobox=!1,n.displayInfobox(!1)):e.current.visProp.showinfobox=r.showCoordsWhenDragging,t.current.highlighted&&n.updateInfobox(e.current),e.current.name=r.labelForGraph;let _=r.labelForGraph!=="";if(_!=T.current&&(e.current.setAttribute({withlabel:_}),T.current=_),e.current.hasLabel){e.current.label.needsUpdate=!0,r.applyStyleToLabel?e.current.label.visProp.strokecolor=y:e.current.label.visProp.strokecolor="var(--canvastext)";let F=ne(r.labelPosition,M.current);if(F!==W.current){let{offset:V,anchorx:se,anchory:pe}=ce(F);e.current.label.visProp.anchorx=se,e.current.label.visProp.anchory=pe,e.current.label.visProp.offset=V,W.current=F,e.current.label.fullUpdate()}else e.current.label.update()}e.current.needsUpdate=!0,e.current.update(),t.current.needsUpdate=!0,t.current.update(),n.updateRenderer()}return G.jsx("a",{name:z})}if(r.hidden)return null;let ue="\\("+r.latex+"\\)",ae=ye(q,r.selectedStyle);return G.jsxs(G.Fragment,{children:[G.jsx("a",{name:z}),G.jsx("span",{id:z,style:ae,children:G.jsx(be,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:ue})})]})});export{Re as default};
