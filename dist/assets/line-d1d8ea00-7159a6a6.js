import{M as H,u as N,r as o,h as I,i as V,j as f,t as $,a as q}from"./index-2b5c64d9.js";import{BoardContext as z,LINE_LAYER_OFFSET as W}from"./graph-6d43a295-5c8ba528.js";import"./css-ab4d83ca-d016d639.js";const ee=H.memo(function m(R){var M;let{name:g,id:O,SVs:e,actions:c,callAction:s}=N(R);m.ignoreActionsWithoutCore=()=>!0;const u=o.useContext(z);let r=o.useRef({}),b=o.useRef(null),x=o.useRef(null),w=o.useRef(!1),L=o.useRef(!1),h=o.useRef(!1),F=o.useRef(null),D=o.useRef(null),a=o.useRef(null),_=o.useRef(null),P=o.useRef(!1),k=o.useRef(!1),j=o.useRef(!1);_.current=e.numericalPoints,P.current=e.fixed,k.current=!e.draggable||e.fixLocation||e.fixed,j.current=e.switchable&&!e.fixed;const E=I(V);o.useEffect(()=>()=>{Object.keys(r.current).length!==0&&U(),u&&u.off("move",G)},[]),o.useEffect(()=>{u&&u.on("move",G)},[u]);function J(){var p;if(((p=e.numericalPoints)==null?void 0:p.length)!==2||e.numericalPoints.some(t=>t.length!==2)){r.current={};return}let y=e.labelForGraph!=="",v=E==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;var d={name:e.labelForGraph,visible:!e.hidden,withlabel:y,fixed:P.current,layer:10*e.layer+W,strokeColor:v,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:v,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:Y(e.selectedStyle.lineStyle,e.dashed),highlight:!k.current};if(y){let t,i,l;e.labelPosition==="upperright"?(l=[5,5],t="left",i="bottom"):e.labelPosition==="upperleft"?(l=[-5,5],t="right",i="bottom"):e.labelPosition==="lowerright"?(l=[5,-5],t="left",i="top"):(l=[-5,-5],t="right",i="top"),d.label={offset:l,anchorx:t,anchory:i,position:"top",highlight:!1},e.labelHasLatex&&(d.label.useMathJax=!0),e.applyStyleToLabel?d.label.strokeColor=v:d.label.strokeColor="var(--canvastext)"}else d.label={highlight:!1},e.labelHasLatex&&(d.label.useMathJax=!0);let S=[[...e.numericalPoints[0]],[...e.numericalPoints[1]]],n=u.create("line",S,d);n.isDraggable=!k.current,n.on("drag",function(t){let i=t.type==="pointermove";if((!i||Math.abs(t.x-b.current[0])>.1||Math.abs(t.y-b.current[1])>.1)&&(h.current=!0),a.current=[],i){var l=u.origin.scrCoords;for(let C=0;C<2;C++){let B=(x.current[C][1]+t.x-b.current[0]-l[1])/u.unitX,T=(l[2]-(x.current[C][2]+t.y-b.current[1]))/u.unitY;a.current.push([B,T])}}else a.current.push([n.point1.X(),n.point1.Y()]),a.current.push([n.point2.X(),n.point2.Y()]);s({action:c.moveLine,args:{point1coords:a.current[0],point2coords:a.current[1],transient:!0,skippable:!0}}),n.point1.coords.setCoordinates(JXG.COORDS_BY_USER,_.current[0]),n.point2.coords.setCoordinates(JXG.COORDS_BY_USER,_.current[1])}),n.on("up",function(t){h.current?s({action:c.moveLine,args:{point1coords:a.current[0],point2coords:a.current[1]}}):!L.current&&!P.current&&(j.current?(s({action:c.switchLine}),s({action:c.lineClicked,args:{name:g}})):s({action:c.lineClicked,args:{name:g}})),w.current=!1}),n.on("keyfocusout",function(t){h.current&&(s({action:c.moveLine,args:{point1coords:a.current[0],point2coords:a.current[1]}}),h.current=!1)}),n.on("down",function(t){h.current=!1,b.current=[t.x,t.y],x.current=[[...n.point1.coords.scrCoords],[...n.point2.coords.scrCoords]],w.current=!0,L.current=!1,P.current||s({action:c.lineFocused,args:{name:g}})}),n.on("hit",function(t){h.current=!1,x.current=[[...n.point1.coords.scrCoords],[...n.point2.coords.scrCoords]],s({action:c.lineFocused,args:{name:g}})}),n.on("keydown",function(t){t.key==="Enter"&&(h.current&&(s({action:c.moveLine,args:{point1coords:a.current[0],point2coords:a.current[1]}}),h.current=!1),j.current?(s({action:c.switchLine}),s({action:c.lineClicked,args:{name:g}})):s({action:c.lineClicked,args:{name:g}}))}),F.current=e.labelForGraph!=="",r.current=n}function G(p){w.current&&(Math.abs(p.x-b.current[0])>.1||Math.abs(p.y-b.current[1])>.1)&&(L.current=!0)}function U(){r.current.off("drag"),r.current.off("down"),r.current.off("hit"),r.current.off("up"),r.current.off("keyfocusout"),r.current.off("keydown"),u.removeObject(r.current),r.current={}}if(u){if(Object.keys(r.current).length===0)J();else if(((M=e.numericalPoints)==null?void 0:M.length)!==2||e.numericalPoints.some(p=>p.length!==2))U();else{let p=!0;for(let t of[e.numericalPoints[0],e.numericalPoints[1]])Number.isFinite(t[0])||(p=!1),Number.isFinite(t[1])||(p=!1);r.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalPoints[0]),r.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalPoints[1]);let y=!e.hidden;if(p){let t=r.current.visProp.visible!==y;r.current.visProp.visible=y,r.current.visPropCalc.visible=y,t&&r.current.setAttribute({visible:y})}else r.current.visProp.visible=!1,r.current.visPropCalc.visible=!1;r.current.visProp.fixed=P.current,r.current.visProp.highlight=!k.current,r.current.isDraggable=!k.current;let v=10*e.layer+W;r.current.visProp.layer!==v&&r.current.setAttribute({layer:v});let d=E==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;r.current.visProp.strokecolor!==d&&(r.current.visProp.strokecolor=d,r.current.visProp.highlightstrokecolor=d),r.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(r.current.visProp.strokewidth=e.selectedStyle.lineWidth,r.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),r.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(r.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,r.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let S=Y(e.selectedStyle.lineStyle,e.dashed);r.current.visProp.dash!==S&&(r.current.visProp.dash=S),r.current.name=e.labelForGraph;let n=e.labelForGraph!=="";if(n!=F.current&&(r.current.setAttribute({withlabel:n}),F.current=n),r.current.needsUpdate=!0,r.current.update(),r.current.hasLabel)if(r.current.label.needsUpdate=!0,e.applyStyleToLabel?r.current.label.visProp.strokecolor=d:r.current.label.visProp.strokecolor="var(--canvastext)",e.labelPosition!==D.current){let t,i,l;e.labelPosition==="upperright"?(l=[5,5],t="left",i="bottom"):e.labelPosition==="upperleft"?(l=[-5,5],t="right",i="bottom"):e.labelPosition==="lowerright"?(l=[5,-5],t="left",i="top"):(l=[-5,-5],t="right",i="top"),r.current.label.visProp.anchorx=t,r.current.label.visProp.anchory=i,r.current.label.visProp.offset=l,D.current=e.labelPosition,r.current.label.fullUpdate()}else r.current.label.update();u.updateRenderer()}return f.jsx(f.Fragment,{children:f.jsx("a",{name:O})})}if(e.hidden)return null;let X="\\("+e.latex+"\\)",A=$(E,e.selectedStyle);return f.jsxs(f.Fragment,{children:[f.jsx("a",{name:O}),f.jsx("span",{id:O,style:A,children:f.jsx(q,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:X})})]})});function Y(m,R){return m==="dashed"||R?2:m==="solid"?0:m==="dotted"?1:0}export{ee as default};
