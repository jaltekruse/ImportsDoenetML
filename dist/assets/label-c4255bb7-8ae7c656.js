import{M as oe,u as ce,r as n,h as ue,i as se,C as K,g as W,j as F,t as ie,a as ae}from"./index-2b5c64d9.js";import{BoardContext as le,TEXT_LAYER_OFFSET as Z}from"./graph-6d43a295-5c8ba528.js";import"./css-ab4d83ca-d016d639.js";const ge=oe.memo(function q(H){let{name:R,id:E,SVs:r,children:de,actions:d,callAction:h}=ce(H);q.ignoreActionsWithoutCore=()=>!0;let e=n.useRef(null),S=n.useRef(null),_=n.useRef(null);const t=n.useContext(le);let v=n.useRef(null),P=n.useRef(null),O=n.useRef(!1),D=n.useRef(!1),l=n.useRef(!1),f=n.useRef(null),p=n.useRef(null),J=n.useRef(null),L=n.useRef(null),b=n.useRef(!1),C=n.useRef(!1);b.current=r.fixed,C.current=!r.draggable||r.fixLocation||r.fixed;const k=ue(se);n.useEffect(()=>()=>{e.current!==null&&Q(),t&&t.off("move",w)},[]),n.useEffect(()=>{t&&t.on("move",w)},[t]);function I(){let u=k==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,a=k==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,y="";a&&(y+=`background-color: ${a}`);let i={visible:!r.hidden,fixed:b.current,layer:10*r.layer+Z,cssStyle:y,highlightCssStyle:y,strokeColor:u,strokeOpacity:1,highlightStrokeColor:u,highlightStrokeOpacity:.5,highlight:!C.current,useMathJax:r.hasLatex,parse:!1},s;try{let c=K.fromAst(r.anchor),m=[c.get_component(0).evaluate_to_constant(),c.get_component(1).evaluate_to_constant()];Number.isFinite(m[0])||(m[0]=0,i.visible=!1),Number.isFinite(m[1])||(m[1]=0,i.visible=!1),s=t.create("point",m,{visible:!1})}catch{i.visible=!1,s=t.create("point",[0,0],{visible:!1})}i.anchor=s;let{anchorx:g,anchory:x}=W(r.positionFromAnchor);i.anchorx=g,i.anchory=x,_.current=[g,x];let o=t.create("text",[0,0,r.value],i);o.isDraggable=!C.current,o.on("down",function(c){v.current=[c.x,c.y],P.current=[...s.coords.scrCoords],l.current=!1,O.current=!0,D.current=!1,b.current||h({action:d.labelFocused,args:{name:R}})}),o.on("hit",function(c){P.current=[...s.coords.scrCoords],l.current=!1,h({action:d.labelFocused,args:{name:R}})}),o.on("up",function(c){l.current?(h({action:d.moveLabel,args:{x:f.current,y:p.current}}),l.current=!1):!D.current&&!b.current&&h({action:d.labelClicked,args:{name:R}}),O.current=!1}),o.on("keyfocusout",function(c){l.current&&(h({action:d.moveLabel,args:{x:f.current,y:p.current}}),l.current=!1)}),o.on("drag",function(c){let m=c.type==="pointermove";(!m||Math.abs(c.x-v.current[0])>.1||Math.abs(c.y-v.current[1])>.1)&&(l.current=!0);let[B,N,X,Y]=t.getBoundingBox(),j=o.size[0]/t.unitX,T=o.size[1]/t.unitY,z=_.current[0],V=_.current[1],M=0;z==="middle"?M=-j/2:z==="right"&&(M=-j);let A=0;V==="middle"?A=-T/2:V==="top"&&(A=-T);let ee=B+.04*(X-B)-M-j,re=X-.04*(X-B)-M,te=Y+.04*(N-Y)-A-T,ne=N-.04*(N-Y)-A;if(m){var $=t.origin.scrCoords;f.current=(P.current[1]+c.x-v.current[0]-$[1])/t.unitX,p.current=($[2]-(P.current[2]+c.y-v.current[1]))/t.unitY}else f.current=s.X()+o.relativeCoords.usrCoords[1],p.current=s.Y()+o.relativeCoords.usrCoords[2];f.current=Math.min(re,Math.max(ee,f.current)),p.current=Math.min(ne,Math.max(te,p.current)),h({action:d.moveLabel,args:{x:f.current,y:p.current,transient:!0,skippable:!0}}),o.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),s.coords.setCoordinates(JXG.COORDS_BY_USER,J.current)}),o.on("keydown",function(c){c.key==="Enter"&&(l.current&&(h({action:d.moveLabel,args:{x:f.current,y:p.current}}),l.current=!1),h({action:d.labelClicked,args:{name:R}}))}),e.current=o,S.current=s,L.current=r.positionFromAnchor,r.hasLatex&&setTimeout(()=>{e.current&&(e.current.needsUpdate=!0,e.current.setText(r.value),e.current.update(),t==null||t.updateRenderer())},1e3)}function w(u){O.current&&(Math.abs(u.x-v.current[0])>.1||Math.abs(u.y-v.current[1])>.1)&&(D.current=!0)}function Q(){e.current.off("drag"),e.current.off("down"),e.current.off("hit"),e.current.off("up"),e.current.off("keyfocusout"),e.current.off("keydown"),t.removeObject(e.current),e.current=null}if(t){let u;try{let a=K.fromAst(r.anchor);u=[a.get_component(0).evaluate_to_constant(),a.get_component(1).evaluate_to_constant()]}catch{u=[NaN,NaN]}if(J.current=u,e.current===null)I();else{e.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),S.current.coords.setCoordinates(JXG.COORDS_BY_USER,u),e.current.setText(r.value);let a=!r.hidden;if(Number.isFinite(u[0])&&Number.isFinite(u[1])){let x=e.current.visProp.visible!==a;e.current.visProp.visible=a,e.current.visPropCalc.visible=a,x&&e.current.setAttribute({visible:a})}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1;let y=10*r.layer+Z;e.current.visProp.layer!==y&&e.current.setAttribute({layer:y});let i=k==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,s=k==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,g="";if(s?g+=`background-color: ${s}`:g+="background-color: transparent",e.current.visProp.strokecolor!==i&&(e.current.visProp.strokecolor=i,e.current.visProp.highlightstrokecolor=i),e.current.visProp.cssstyle!==g&&(e.current.visProp.cssstyle=g,e.current.visProp.highlightcssstyle=g),e.current.visProp.highlight=!C.current,e.current.visProp.fixed=b.current,e.current.isDraggable=!C.current,e.current.needsUpdate=!0,r.positionFromAnchor!==L.current){let{anchorx:x,anchory:o}=W(r.positionFromAnchor);e.current.visProp.anchorx=x,e.current.visProp.anchory=o,_.current=[x,o],L.current=r.positionFromAnchor,e.current.fullUpdate()}else e.current.update();S.current.needsUpdate=!0,S.current.update(),t.updateRenderer()}return F.jsx("a",{name:E})}if(r.hidden)return null;let G=ie(k,r.selectedStyle);G.marginRight="12px";let U=r.value;return r.hasLatex&&(U=F.jsx(ae,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:U})),F.jsxs("span",{id:E,style:G,children:[F.jsx("a",{name:E}),U]})});export{ge as default};
