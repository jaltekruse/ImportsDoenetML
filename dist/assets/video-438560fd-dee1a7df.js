import{z as G,M,u as W,r as c,j as m,V as F}from"./index-2b5c64d9.js";import{i as L}from"./css-ab4d83ca-d016d639.js";const $=G.div`
  &: focus {
    outline: 2px solid var(--canvastext);
    outline-offset: 2px;
  }
`,_=M.memo(function(k){var R;let{name:z,id:T,SVs:n,actions:a,callAction:u}=W(k),t=c.useRef(null),p=c.useRef(null),l=c.useRef(null),i=c.useRef([]),s=c.useRef(null),Y=c.useRef(null),P=c.useRef(0),d=c.useRef(null),f=c.useRef(null),w=c.useRef(null),j=e=>{u({action:a.recordVisibilityChange,args:{isVisible:e}})};c.useEffect(()=>()=>{u({action:a.recordVisibilityChange,args:{isVisible:!1}})},[]),c.useEffect(()=>{if(n.youtube){let e=T;window.YT&&(t.current=new window.YT.Player(e,{playerVars:{autoplay:0,controls:1,modestbranding:1,rel:0},events:{onReady:N,onStateChange:I,onPlaybackRateChange:U}}))}},[window.YT]);function A(){let e=t.current.getCurrentTime(),r;p.current?r=e-p.current:r=e-l.current,!(l.current>=0)||r>0&&r<1?(l.current=e,p.current=null):r!==0&&(p.current=e);let g=Math.floor(e);g!==w.current&&(w.current=g,u({action:a.setTime,args:{time:g}}))}function N(e){u({action:a.recordVideoReady,args:{duration:t.current.getDuration()}})}function I(e){let r=t.current.getDuration();switch(e.data){case window.YT.PlayerState.PLAYING:if(s.current!==e.data){let o=t.current.getCurrentTime();if(clearInterval(f.current),f.current=window.setInterval(A,200),s.current===window.YT.PlayerState.PAUSED){let v=o-P.current;(v<0||v>.5)&&u({action:a.recordVideoSkipped,args:{beginTime:P.current,endTime:o,duration:r}})}let D=t.current.getPlaybackRate();i.current=[{startingPoint:o,rate:D}],d.current=o,l.current=o,p.current=null,u({action:a.recordVideoStarted,args:{beginTime:t.current.getCurrentTime(),duration:r,rate:D}}),s.current=e.data}break;case window.YT.PlayerState.PAUSED:let g=s.current,C=d.current,y=t.current.getCurrentTime();Y.current=setTimeout(function(){clearInterval(f.current),g===window.YT.PlayerState.PLAYING&&y>C&&(i.current[i.current.length-1].endingPoint=y,u({action:a.recordVideoWatched,args:{beginTime:C,endTime:y,duration:r,rates:i.current}}),d.current=null),u({action:a.recordVideoPaused,args:{endTime:y,duration:r}}),P.current=y,s.current=e.data},250);break;case window.YT.PlayerState.BUFFERING:clearTimeout(Y.current);let E=t.current.getCurrentTime();if(d.current!==null){let o=d.current;l.current>o&&(i.current[i.current.length-1].endingPoint=l.current,u({action:a.recordVideoWatched,args:{beginTime:o,endTime:l.current,duration:r,rates:i.current}}),o=l.current),u({action:a.recordVideoSkipped,args:{beginTime:o,endTime:E,duration:r}}),s.current=e.data,d.current=null,l.current=E,p.current=null}break;case window.YT.PlayerState.ENDED:clearInterval(f.current);let h=d.current,V=t.current.getCurrentTime();i.current.length>0&&h!==null&&V>h&&(i.current[i.current.length-1].endingPoint=V,u({action:a.recordVideoWatched,args:{beginTime:h,endTime:V,duration:r,rates:i.current}}),d.current=null),u({action:a.recordVideoCompleted,args:{duration:r}}),s.current=e.data;break;case window.YT.PlayerState.UNSTARTED:s.current=e.data;break}}function U(e){let r=t.current.getCurrentTime();i.current[i.current.length-1].endingPoint=r,i.current.push({startingPoint:r,rate:e.data})}if((R=t.current)!=null&&R.getPlayerState){let e=t.current.getPlayerState();if(n.state==="playing"?(e===window.YT.PlayerState.UNSTARTED||e===window.YT.PlayerState.PAUSED||e===window.YT.PlayerState.CUED||e===window.YT.PlayerState.ENDED)&&t.current.playVideo():n.state==="stopped"&&e===window.YT.PlayerState.PLAYING&&t.current.pauseVideo(),n.time!==Number(w.current)){let r=n.time,g=t.current.getDuration();r>g&&(r=Math.floor(g),u({action:a.setTime,args:{time:r}})),r!==Number(w.current)&&(t.current.getPlayerState()===window.YT.PlayerState.CUED?(t.current.pauseVideo(),t.current.seekTo(r,!0),setTimeout(()=>t.current.pauseVideo(),200)):t.current.seekTo(r,!0),w.current=r)}}if(n.hidden)return null;let S={};n.displayMode==="inline"?S={display:"inline-block",verticalAlign:"middle",margin:"12px 0"}:S={display:"flex",justifyContent:n.horizontalAlign,margin:"12px 0"};let x={maxWidth:"100%",width:L(n.width),aspectRatio:String(n.aspectRatio)},b;return n.youtube?b=m.jsx("iframe",{id:T,style:x,src:"https://www.youtube.com/embed/"+n.youtube+"?enablejsapi=1&rel=0&modestbranding=1",allow:"autoplay; fullscreen"}):n.source?b=m.jsxs("video",{className:"video",id:T,controls:!0,style:x,children:[m.jsx("source",{src:n.source,type:`video/${n.source.split("/").pop().split(".").pop()}`}),"Your browser does not support the <video> tag."]}):b=m.jsx("span",{id:T}),m.jsx(F,{partialVisibility:!0,onChange:j,children:m.jsxs($,{tabIndex:"0",style:S,id:T+"_outer",children:[m.jsx("a",{name:T}),b]})})});export{_ as default};
