import{M as q,u as z,r as l,h as Z,i as $,j as I}from"./index-2b5c64d9.js";import{BoardContext as ee,LINE_LAYER_OFFSET as N,VERTEX_LAYER_OFFSET as B}from"./graph-6d43a295-5c8ba528.js";import"./css-ab4d83ca-d016d639.js";const oe=q.memo(function S(H){let{name:v,id:K,SVs:e,actions:d,sourceOfUpdate:F,callAction:m}=z(H);S.ignoreActionsWithoutCore=()=>!0;const i=l.useContext(ee);let r=l.useRef(null),c=l.useRef(null),f=l.useRef(null),y=l.useRef(null),O=l.useRef(null),b=l.useRef(null),M=l.useRef(null),X=l.useRef(!1),_=l.useRef(!1),C=l.useRef(null),V=l.useRef(null),P=l.useRef(null),x=l.useRef(!1),R=l.useRef(!1),w=l.useRef(!1);P.current=e.numericalVertices,x.current=e.fixed,R.current=!e.draggable||e.fixLocation||e.fixed,w.current=!e.verticesDraggable||e.fixed||e.fixLocation;const T=Z($);l.useEffect(()=>()=>{r.current&&U(),i&&i.off("move",W)},[]),l.useEffect(()=>{i&&i.on("move",W)},[i]);function Q(){if(e.numericalVertices.length!==e.numVertices||e.numericalVertices.some(t=>t.length!==2))return null;let n=!0;for(let t of e.numericalVertices)Number.isFinite(t[0])||(n=!1),Number.isFinite(t[1])||(n=!1);let s=T==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor,a={name:e.labelForGraph,visible:!e.hidden&&n,withLabel:e.labelForGraph!=="",layer:10*e.layer+N,fixed:x.current,strokeColor:s,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:s,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:J(e.selectedStyle.lineStyle),highlight:!R.current,lineCap:"butt"};V.current=Object.assign({},a),Object.assign(V.current,{fixed:!1,highlight:!0,withLabel:!1,fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),layer:10*e.layer+B}),(w.current||e.hidden||!n)&&(V.current.visible=!1),a.label={highlight:!1},e.labelHasLatex&&(a.label.useMathJax=!0),e.applyStyleToLabel?a.label.strokeColor=s:a.label.strokeColor="var(--canvastext)",c.current=[];for(let t=0;t<e.numVertices;t++)c.current.push(i.create("point",[...e.numericalVertices[t]],V.current));let g=[],k=[];e.numericalVertices.forEach(t=>{g.push(t[0]),k.push(t[1])});let p=i.create("curve",[g,k],a);p.isDraggable=!R.current;for(let t=0;t<e.numVertices;t++)c.current[t].on("drag",h=>D(t,h)),c.current[t].on("up",()=>j(t)),c.current[t].on("keyfocusout",()=>A(t)),c.current[t].on("keydown",h=>G(t,h)),c.current[t].on("down",h=>L(t,h)),c.current[t].on("hit",h=>Y());return p.on("drag",t=>D(-1,t)),p.on("up",()=>j(-1)),p.on("keyfocusout",()=>A(-1)),p.on("keydown",t=>G(-1,t)),p.on("down",t=>L(-1,t)),p.on("hit",t=>Y()),C.current=e.numVertices,p}function W(n){X.current&&(Math.abs(n.x-b.current[0])>.1||Math.abs(n.y-b.current[1])>.1)&&(_.current=!0)}function U(){r.current.off("drag"),r.current.off("down"),r.current.off("hit"),r.current.off("up"),r.current.off("keyfocusout"),r.current.off("keydown"),i.removeObject(r.current),r.current=null;for(let n=0;n<e.numVertices;n++)c.current[n].off("drag"),c.current[n].off("down"),c.current[n].off("hit"),c.current[n].off("up"),c.current[n].off("keyfocusout"),c.current[n].off("keydown"),i.removeObject(c.current[n]),delete c.current[n]}function D(n,s){let a=s.type==="pointermove";if(!a||Math.abs(s.x-b.current[0])>.1||Math.abs(s.y-b.current[1])>.1)if(y.current=n,n===-1){r.current.updateTransformMatrix();let k=r.current.transformMat[1][0],p=r.current.transformMat[2][0];var g=i.origin.scrCoords;f.current=[];for(let t=0;t<r.current.points.length;t++)if(a){let h=(M.current[t][1]+s.x-b.current[0]-g[1])/i.unitX,E=(g[2]-(M.current[t][2]+s.y-b.current[1]))/i.unitY;f.current.push([h,E])}else f.current.push([r.current.dataX[t]+k,r.current.dataY[t]+p]);m({action:d.movePolyline,args:{pointCoords:f.current,transient:!0,skippable:!0}});for(let t=0;t<e.numVertices;t++)c.current[t].coords.setCoordinates(JXG.COORDS_BY_USER,[...P.current[t]]),r.current.dataX[t]=P.current[t][0]-k,r.current.dataY[t]=P.current[t][1]-p}else f.current={},f.current[n]=[c.current[n].X(),c.current[n].Y()],m({action:d.movePolyline,args:{pointCoords:f.current,transient:!0,skippable:!0,sourceDetails:{vertex:n}}}),c.current[n].coords.setCoordinates(JXG.COORDS_BY_USER,[...P.current[n]]),i.updateInfobox(c.current[n])}function L(n,s){y.current=null,b.current=[s.x,s.y],n===-1?(O.current===null&&!x.current&&m({action:d.polylineFocused,args:{name:v}}),M.current=r.current.points.map(a=>[...a.scrCoords])):(w.current||m({action:d.polylineFocused,args:{name:v}}),O.current=n),X.current=!0,_.current=!1}function Y(){y.current=null,m({action:d.polylineFocused,args:{name:v}})}function j(n){y.current===n?m(n===-1?{action:d.movePolyline,args:{pointCoords:f.current}}:{action:d.movePolyline,args:{pointCoords:f.current,sourceDetails:{vertex:n}}}):!_.current&&(O.current===null||n!==-1)&&!x.current&&m({action:d.polylineClicked,args:{name:v}}),n!==-1&&(O.current=null),X.current=!1}function A(n){y.current===n&&m(n===-1?{action:d.movePolyline,args:{pointCoords:f.current}}:{action:d.movePolyline,args:{pointCoords:f.current,sourceInformation:{vertex:n}}}),y.current=null}function G(n,s){s.key==="Enter"&&(y.current===n&&m(n===-1?{action:d.movePolyline,args:{pointCoords:f.current}}:{action:d.movePolyline,args:{pointCoords:f.current,sourceInformation:{vertex:n}}}),y.current=null,m({action:d.polylineClicked,args:{name:v}}))}if(i)if(!r.current)r.current=Q();else if(e.numericalVertices.length!==e.numVertices||e.numericalVertices.some(n=>n.length!==2))U();else{let n=!0;for(let o of e.numericalVertices)Number.isFinite(o[0])||(n=!1),Number.isFinite(o[1])||(n=!1);r.current.visProp.fixed=x.current,r.current.visProp.highlight=!R.current,r.current.isDraggable=!R.current;let s=10*e.layer+N,a=r.current.visProp.layer!==s,g=10*e.layer+B;if(a&&(r.current.setAttribute({layer:s}),V.current.layer=g),e.numVertices>C.current)for(let o=C.current;o<e.numVertices;o++)c.current.push(i.create("point",[...e.numericalVertices[o]],V.current)),r.current.dataX.length=e.numVertices,c.current[o].on("drag",u=>D(o,u)),c.current[o].on("up",u=>j(o)),c.current[o].on("down",u=>L(o,u)),c.current[o].on("hit",u=>Y()),c.current[o].on("keyfocusout",u=>A(o)),c.current[o].on("keydown",u=>G(o,u));else if(e.numVertices<C.current){for(let o=e.numVertices;o<C.current;o++){let u=c.current.pop();u.off("drag"),u.off("down"),u.off("hit"),u.off("up"),u.off("keyfocusout"),u.off("keydown"),i.removeObject(u)}r.current.dataX.length=e.numVertices}C.current=e.numVertices,r.current.updateTransformMatrix();let k=r.current.transformMat[1][0],p=r.current.transformMat[2][0];for(let o=0;o<e.numVertices;o++)c.current[o].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalVertices[o]]),r.current.dataX[o]=e.numericalVertices[o][0]-k,r.current.dataY[o]=e.numericalVertices[o][1]-p;let t=!e.hidden;if(n){r.current.visProp.visible=t,r.current.visPropCalc.visible=t;let o=t&&!w.current;for(let u=0;u<e.numVertices;u++)c.current[u].visProp.visible=o,c.current[u].visPropCalc.visible=o}else{r.current.visProp.visible=!1,r.current.visPropCalc.visible=!1;for(let o=0;o<e.numVertices;o++)c.current[o].visProp.visible=!1,c.current[o].visPropCalc.visible=!1}let h=T==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;r.current.visProp.strokecolor!==h&&(r.current.visProp.strokecolor=h,r.current.visProp.highlightstrokecolor=h),r.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(r.current.visProp.strokewidth=e.selectedStyle.lineWidth,r.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),r.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(r.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,r.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let E=J(e.selectedStyle.lineStyle);if(r.current.visProp.dash!==E&&(r.current.visProp.dash=E),r.current.name=e.labelForGraph,r.current.hasLabel&&(e.applyStyleToLabel?r.current.label.visProp.strokecolor=h:r.current.label.visProp.strokecolor="var(--canvastext)",r.current.label.needsUpdate=!0,r.current.label.update()),F.sourceInformation&&v in F.sourceInformation){let o=F.sourceInformation[v].vertex;Number.isFinite(o)&&i.updateInfobox(c.current[o])}r.current.needsUpdate=!0,r.current.update().updateVisibility();for(let o=0;o<e.numVertices;o++)a&&c.current[o].setAttribute({layer:g}),c.current[o].needsUpdate=!0,c.current[o].update();i.updateRenderer()}return e.hidden?null:I.jsx(I.Fragment,{children:I.jsx("a",{name:K})})});function J(S){return S==="solid"?0:S==="dashed"?2:S==="dotted"?1:0}export{oe as default};
