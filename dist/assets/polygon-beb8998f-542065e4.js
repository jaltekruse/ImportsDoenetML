import{M as q,u as Z,r as d,h as $,i as ee,j as I}from"./index-2b5c64d9.js";import{BoardContext as re,LINE_LAYER_OFFSET as w,VERTEX_LAYER_OFFSET as N}from"./graph-6d43a295-5c8ba528.js";import"./css-ab4d83ca-d016d639.js";const le=q.memo(function k(z){let{name:g,id:K,SVs:e,actions:p,sourceOfUpdate:F,callAction:y}=Z(z);k.ignoreActionsWithoutCore=()=>!0;const c=d.useContext(re);let r=d.useRef(null),h=d.useRef(null),v=d.useRef(null),R=d.useRef(null),m=d.useRef(null),D=d.useRef(null),_=d.useRef(!1),L=d.useRef(!1),b=d.useRef(null),C=d.useRef(null),M=d.useRef(null),S=d.useRef(!1),P=d.useRef(!1),O=d.useRef(!1);M.current=e.numericalVertices,S.current=e.fixed,P.current=!e.draggable||e.fixLocation||e.fixed,O.current=!e.verticesDraggable||e.fixed||e.fixLocation;const V=$(ee);d.useEffect(()=>()=>{r.current&&W(),c&&c.off("move",A)},[]),d.useEffect(()=>{c&&c.on("move",A)},[c]);function Q(){if(!(e.numVertices>=2))return null;let t=V==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor,n=V==="dark"?e.selectedStyle.fillColorDarkMode:e.selectedStyle.fillColor;n=e.filled?n:"none",C.current={fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),visible:!O.current&&!e.hidden,withLabel:!1,layer:10*e.layer+N,highlight:!0};let l={highlight:!1,visible:!e.hidden,layer:10*e.layer+w,fixed:!0,strokeColor:t,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:t,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:H(e.selectedStyle.lineStyle)},i={name:e.labelForGraph,visible:!e.hidden,withLabel:e.labelForGraph!=="",fixed:S.current,layer:10*e.layer+w,fillColor:n,fillOpacity:e.selectedStyle.fillOpacity,highlightFillColor:n,highlightFillOpacity:e.selectedStyle.fillOpacity*.5,highlight:!P.current,vertices:C.current,borders:l};i.label={highlight:!1},e.labelHasLatex&&(i.label.useMathJax=!0),e.applyStyleToLabel?i.label.strokeColor=t:i.label.strokeColor="var(--canvastext)",e.filled&&(i.hasInnerPoints=!0),c.suspendUpdate();let u=[];for(let f of e.numericalVertices)u.push(c.create("point",[...f],C.current));let a=c.create("polygon",u,i);return a.isDraggable=!P.current,U(a),a.on("drag",f=>Y(-1,f)),a.on("up",f=>j(-1)),a.on("keyfocusout",f=>T(-1)),a.on("keydown",f=>J(-1,f)),a.on("down",f=>G(-1,f)),a.on("hit",f=>X()),c.unsuspendUpdate(),b.current=e.numVertices,a}function A(t){_.current&&(Math.abs(t.x-m.current[0])>.1||Math.abs(t.y-m.current[1])>.1)&&(L.current=!0)}function U(t){for(let n=0;n<e.numVertices;n++){let l=t.vertices[n];l.off("drag"),l.on("drag",i=>Y(n,i)),l.off("up"),l.on("up",()=>j(n)),l.off("keyfocusout"),l.on("keyfocusout",()=>T(n)),l.off("keydown"),l.on("keydown",i=>J(n,i)),l.off("down"),l.on("down",i=>G(n,i)),l.off("hit"),l.on("hit",i=>X())}}function W(){for(let t=0;t<e.numVertices;t++){let n=r.current.vertices[t];n&&(n.off("drag"),n.off("up"),n.off("down"),n.off("hit"))}r.current.off("drag"),r.current.off("up"),r.current.off("down"),r.current.off("hit"),c.removeObject(r.current),r.current=null}function Y(t,n){let l=n.type==="pointermove";if(!l||Math.abs(n.x-m.current[0])>.1||Math.abs(n.y-m.current[1])>.1)if(v.current=t,t===-1){h.current=[];var i=c.origin.scrCoords;for(let u=0;u<r.current.vertices.length-1;u++)if(l){let a=(D.current[u][1]+n.x-m.current[0]-i[1])/c.unitX,f=(i[2]-(D.current[u][2]+n.y-m.current[1]))/c.unitY;h.current.push([a,f])}else{let a=r.current.vertices[u];h.current.push([a.X(),a.Y()])}y({action:p.movePolygon,args:{pointCoords:h.current,transient:l,skippable:l}});for(let u=0;u<e.numVertices;u++)r.current.vertices[u].coords.setCoordinates(JXG.COORDS_BY_USER,[...M.current[u]])}else h.current={},h.current[t]=[r.current.vertices[t].X(),r.current.vertices[t].Y()],y({action:p.movePolygon,args:{pointCoords:h.current,transient:l,skippable:l,sourceDetails:{vertex:t}}}),r.current.vertices[t].coords.setCoordinates(JXG.COORDS_BY_USER,[...M.current[t]]),c.updateInfobox(r.current.vertices[t])}function G(t,n){v.current=null,m.current=[n.x,n.y],t===-1?(R.current===null&&!S.current&&y({action:p.polygonFocused,args:{name:g}}),D.current=r.current.vertices.map(l=>[...l.coords.scrCoords])):(O.current||y({action:p.polygonFocused,args:{name:g}}),R.current=t),_.current=!0,L.current=!1}function X(){v.current=null,y({action:p.polygonFocused,args:{name:g}})}function j(t){v.current===t?y(t===-1?{action:p.movePolygon,args:{pointCoords:h.current}}:{action:p.movePolygon,args:{pointCoords:h.current,sourceDetails:{vertex:t}}}):!L.current&&(R.current===null||t!==-1)&&!S.current&&y({action:p.polygonClicked,args:{name:g}}),t!==-1&&(R.current=null),_.current=!1}function T(t){v.current===t&&y(t===-1?{action:p.movePolygon,args:{pointCoords:h.current}}:{action:p.movePolygon,args:{pointCoords:h.current,sourceInformation:{vertex:t}}}),v.current=null}function J(t,n){n.key==="Enter"&&(v.current===t&&y(t===-1?{action:p.movePolygon,args:{pointCoords:h.current}}:{action:p.movePolygon,args:{pointCoords:h.current,sourceInformation:{vertex:t}}}),v.current=null,y({action:p.polygonClicked,args:{name:g}}))}if(c)if(!r.current)r.current=Q();else if(!(e.numVertices>=2))W();else{let t=!0;for(let o of e.numericalVertices)Number.isFinite(o[0])||(t=!1),Number.isFinite(o[1])||(t=!1);if(e.numVertices>b.current){for(let o=b.current;o<e.numVertices;o++){let s=c.create("point",[...e.numericalVertices[o]],C.current);r.current.addPoints(s)}U(r.current)}else if(e.numVertices<b.current){for(let o=b.current-1;o>=e.numVertices;o--)r.current.vertices[o].off("drag"),r.current.vertices[o].off("down"),r.current.vertices[o].off("hit"),r.current.vertices[o].off("up"),r.current.vertices[o].off("keyfocusout"),r.current.vertices[o].off("keydown"),r.current.removePoints(r.current.vertices[o]);U(r.current)}let n=!O.current&&!e.hidden;for(let o=0;o<e.numVertices;o++)r.current.vertices[o].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalVertices[o]]),r.current.vertices[o].needsUpdate=!0,r.current.vertices[o].update(),r.current.vertices[o].visProp.visible=n,r.current.vertices[o].visPropCalc.visible=n;if(F.sourceInformation&&g in F.sourceInformation){let o=F.sourceInformation[g].vertex;o!==void 0&&c.updateInfobox(r.current.vertices[o])}let l=!e.hidden;t||(l=!1),r.current.visProp.fixed=S.current,r.current.visProp.highlight=!P.current,r.current.isDraggable=!P.current,r.current.visProp.visible=l,r.current.visPropCalc.visible=l;let i=10*e.layer+w,u=r.current.visProp.layer!==i,a,f;u&&(a=10*e.layer+w,f=10*e.layer+N,r.current.setAttribute({layer:i}));let E=V==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor,x=V==="dark"?e.selectedStyle.fillColorDarkMode:e.selectedStyle.fillColor;x=e.filled?x:"none",r.current.name=e.labelForGraph,r.current.hasLabel&&(e.applyStyleToLabel?r.current.label.visProp.strokecolor=E:r.current.label.visProp.strokecolor="var(--canvastext)",r.current.label.needsUpdate=!0,r.current.label.update()),r.current.visProp.fillcolor!==x&&(r.current.visProp.fillcolor=x,r.current.visProp.highlightfillcolor=x,r.current.visProp.hasinnerpoints=e.filled),r.current.visProp.fillopacity!==e.selectedStyle.fillOpacity&&(r.current.visProp.fillopacity=e.selectedStyle.fillOpacity,r.current.visProp.highlightfillopacity=e.selectedStyle.fillOpacity*.5),r.current.needsUpdate=!0,r.current.update().updateVisibility();for(let o=0;o<r.current.borders.length;o++){let s=r.current.borders[o];s.visProp.visible=l,s.visPropCalc.visible=l,u&&s.setAttribute({layer:a}),s.visProp.strokecolor!==E&&(s.visProp.strokecolor=E,s.visProp.highlightstrokecolor=E),s.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(s.visProp.strokeopacity=e.selectedStyle.lineOpacity,s.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let B=H(e.selectedStyle.lineStyle);s.visProp.dash!==B&&(s.visProp.dash=B),s.visProp.strokewidth!==e.selectedStyle.lineWidth&&(s.visProp.strokewidth=e.selectedStyle.lineWidth,s.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),s.needsUpdate=!0,s.update()}if(u){C.current.layer=f;for(let o of r.current.vertices)o.setAttribute({layer:f}),o.needsUpdate=!0,o.update()}b.current=e.numVertices,c.updateRenderer()}return e.hidden?null:I.jsx(I.Fragment,{children:I.jsx("a",{name:K})})});function H(k){return k==="solid"?0:k==="dashed"?2:k==="dotted"?1:0}export{le as default};
