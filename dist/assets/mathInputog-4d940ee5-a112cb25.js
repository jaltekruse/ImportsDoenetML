import{G as u,H as p,C as m,j as a,I as o,F as l,b as x,c as v,d as S,f,M as V}from"./index-2b5c64d9.js";import{m as c}from"./index-89409889-4323041a.js";var D=Object.defineProperty,g=(n,e,t)=>e in n?D(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,b=(n,e,t)=>(g(n,typeof e!="symbol"?e+"":e,t),t);c.addStyles();let y=c.EditableMathField;class F{render(){return null}}class R extends F{constructor(e){console.log("old one"),super(e),this.state={latex:""},this.handlePressEnter=this.handlePressEnter.bind(this),this.handleBlur=this.handleBlur.bind(this),this.handleFocus=this.handleFocus.bind(this),this.onChangeHandler=this.onChangeHandler.bind(this),this.mathExpression=this.doenetSvData.valueForDisplay,this.doenetSvData.rawRendererValue!==null?this.latexValue=this.doenetSvData.rawRendererValue:(this.latexValue=h(this.doenetSvData.valueForDisplay.toLatex()),this.actions.updateRawValue({rawRendererValue:this.latexValue,transient:!1})),this.latexValueSetInRender=!0,this.valueToRevertTo=this.doenetSvData.value,this.valueForDisplayToRevertTo=this.doenetSvData.valueForDisplay,this.latexValue==="＿"&&(this.latexValue="")}componentDidMount(){}calculateMathExpressionFromLatex(e){let t;e=u(e),e=e.replace(/\^(\w)/g,"^{$1}");let i=p({functionSymbols:this.doenetSvData.functionSymbols,splitSymbols:this.doenetSvData.splitSymbols});try{t=i(e)}catch{t=m.fromAst("＿")}return t}updateImmediateValueFromLatex(e){let t=this.calculateMathExpressionFromLatex(this.latexValue),i=this.calculateMathExpressionFromLatex(e),s=e!==this.latexValue||this.latexValueSetFromValueForDisplay,r=!this.latexValueSetInRender,d=!i.equalsViaSyntax(t)||!this.latexValueSetInRender&&e!==this.latexValue;this.latexValue=e,this.latexValueSetInRender=!1,this.latexValueSetFromValueForDisplay=!1,d?(this.mathExpression=i,this.actions.updateImmediateValue({mathExpression:i,rawRendererValue:this.latexValue,transient:!0,skippable:!0})):s&&this.actions.updateRawValue({rawRendererValue:this.latexValue,transient:r,skippable:r})}updateValidationState(){this.validationState="unvalidated",(this.doenetSvData.valueHasBeenValidated||this.doenetSvData.numberOfAttemptsLeft<1)&&(this.doenetSvData.creditAchieved===1?this.validationState="correct":this.doenetSvData.creditAchieved===0?this.validationState="incorrect":this.validationState="partialcorrect")}async handlePressEnter(e){this.valueToRevertTo=this.doenetSvData.immediateValue,this.valueForDisplayToRevertTo=this.mathExpression,this.doenetSvData.value.equalsViaSyntax(this.doenetSvData.immediateValue)?await this.actions.updateRawValue({rawRendererValue:this.latexValue,transient:!1}):await this.actions.updateValue(),this.doenetSvData.includeCheckWork&&this.validationState==="unvalidated"&&await this.actions.submitAnswer(),this.forceUpdate()}handleFocus(e){this.focused=!0,this.forceUpdate()}async handleBlur(e){this.focused=!1,this.valueToRevertTo=this.doenetSvData.immediateValue,this.valueForDisplayToRevertTo=this.mathExpression,this.doenetSvData.value.equalsViaSyntax(this.doenetSvData.immediateValue)?await this.actions.updateRawValue({rawRendererValue:this.latexValue,transient:!1}):await this.actions.updateValue(),this.forceUpdate()}async onChangeHandler(e){this.updateImmediateValueFromLatex(e),this.forceUpdate()}render(){if(this.doenetSvData.hidden)return null;this.updateValidationState();let e=this.doenetSvData.disabled;this.focused,this.valueForDisplayToRevertTo.equalsViaSyntax(this.doenetSvData.valueForDisplay)||(this.mathExpression=this.doenetSvData.valueForDisplay,this.latexValue=h(this.mathExpression.toLatex()),this.latexValue==="＿"&&(this.latexValue=""),this.latexValueSetInRender=!0,this.latexValueSetFromValueForDisplay=!0,this.valueToRevertTo=this.doenetSvData.value,this.valueForDisplayToRevertTo=this.doenetSvData.valueForDisplay);let t={position:"relative",width:"30px",height:"24px",fontSize:"20px",fontWeight:"bold",color:"#ffffff",display:"inline-block",textAlign:"center",top:"3px",padding:"2px",zIndex:"0"},i=null;if(this.doenetSvData.includeCheckWork){if(this.validationState==="unvalidated")e?t.backgroundColor="rgb(200,200,200)":t.backgroundColor="rgb(2, 117, 216)",i=a.jsx("button",{id:this.componentName+"_submit",tabIndex:"0",disabled:e,ref:s=>{this.target=s&&o.findDOMNode(s)},style:t,onClick:this.actions.submitAnswer,onKeyPress:s=>{s.key==="Enter"&&this.actions.submitAnswer()},children:a.jsx(l,{icon:x,transform:{rotate:90}})});else if(this.doenetSvData.showCorrectness)if(this.validationState==="correct")t.backgroundColor="rgb(92, 184, 92)",i=a.jsx("span",{id:this.componentName+"_correct",style:t,ref:s=>{this.target=s&&o.findDOMNode(s)},children:a.jsx(l,{icon:v})});else if(this.validationState==="partialcorrect"){let s=`${Math.round(this.doenetSvData.creditAchieved*100)} %`;t.width="50px",t.backgroundColor="#efab34",i=a.jsx("span",{id:this.componentName+"_partial",style:t,ref:r=>{this.target=r&&o.findDOMNode(r)},children:s})}else t.backgroundColor="rgb(187, 0, 0)",i=a.jsx("span",{id:this.componentName+"_incorrect",style:t,ref:s=>{this.target=s&&o.findDOMNode(s)},children:a.jsx(l,{icon:S})});else t.backgroundColor="rgb(74, 3, 217)",i=a.jsx("span",{id:this.componentName+"_saved",style:t,ref:s=>{this.target=s&&o.findDOMNode(s)},children:a.jsx(l,{icon:f})});this.doenetSvData.numberOfAttemptsLeft<0?i=a.jsxs(a.Fragment,{children:[i,a.jsx("span",{children:"(no attempts remaining)"})]}):this.doenetSvData.numberOfAttemptsLeft<1/0&&(i=a.jsxs(a.Fragment,{children:[i,a.jsxs("span",{children:["(attempts remaining: ",this.doenetSvData.numberOfAttemptsLeft,")"]})]}))}return a.jsxs(V.Fragment,{children:[a.jsx("a",{name:this.componentName}),a.jsxs("span",{className:"textInputSurroundingBox",id:this.componentName,children:[a.jsx("span",{style:{margin:"10px"},children:a.jsx(y,{latex:this.latexValue,config:{autoCommands:"sqrt pi theta integral infinity",autoOperatorNames:"arg deg det dim exp gcd hom ker lg lim ln log max min Pr sin cos tan arcsin arccos arctan sinh cosh tanh sec csc cot coth sin cos tan sec cosec csc cotan cot ctg arcsin arccos arctan arcsec arccosec arccsc arccotan arccot arcctg sinh cosh tanh sech cosech csch cotanh coth ctgh arsinh arcosh artanh arsech arcosech arcsch arcotanh arcoth arctgh arcsinh arccosh arctanh arcsech arccosech arccsch arccotanh arccoth arcctgh",handlers:{enter:this.handlePressEnter}},onChange:s=>{this.onChangeHandler(s.latex())},onBlur:this.handleBlur,onFocus:this.handleFocus})}),i]})]})}}b(R,"initializeChildrenOnConstruction",!1);function h(n){return n.replaceAll("\\,","").replaceAll(/\\var{([^{}]*)}/g,"$1")}export{R as default};
