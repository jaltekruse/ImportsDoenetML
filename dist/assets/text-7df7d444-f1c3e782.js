import{M as ne,u as oe,r as n,h as ce,i as ue,C as $,g as z,j as R,t as se}from"./index-2b5c64d9.js";import{BoardContext as ie,TEXT_LAYER_OFFSET as K}from"./graph-6d43a295-5c8ba528.js";import"./css-ab4d83ca-d016d639.js";const he=ne.memo(function Q(V){let{name:_,id:O,SVs:r,actions:d,sourceOfUpdate:ae,callAction:f}=oe(V);Q.ignoreActionsWithoutCore=()=>!0;let e=n.useRef(null),S=n.useRef(null),P=n.useRef(null);const t=n.useContext(ie);let m=n.useRef(null),F=n.useRef(null),E=n.useRef(!1),D=n.useRef(!1),l=n.useRef(!1),h=n.useRef(null),p=n.useRef(null),w=n.useRef(null),B=n.useRef(null),C=n.useRef(!1),b=n.useRef(!1);C.current=r.fixed,b.current=!r.draggable||r.fixLocation||r.fixed;const k=ce(ue);n.useEffect(()=>()=>{e.current!==null&&q(),t&&t.off("move",G)},[]),n.useEffect(()=>{t&&t.on("move",G)},[t]);function Z(){let u=k==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,a=k==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,v="";a&&(v+=`background-color: ${a}`);let i={visible:!r.hidden,fixed:C.current,layer:10*r.layer+K,cssStyle:v,highlightCssStyle:v,strokeColor:u,strokeOpacity:1,highlightStrokeColor:u,highlightStrokeOpacity:.5,highlight:!b.current,parse:!1},s;try{let c=$.fromAst(r.anchor),x=[c.get_component(0).evaluate_to_constant(),c.get_component(1).evaluate_to_constant()];Number.isFinite(x[0])||(x[0]=0,i.visible=!1),Number.isFinite(x[1])||(x[1]=0,i.visible=!1),s=t.create("point",x,{visible:!1})}catch{i.visible=!1,s=t.create("point",[0,0],{visible:!1})}i.anchor=s;let{anchorx:g,anchory:y}=z(r.positionFromAnchor);i.anchorx=g,i.anchory=y,P.current=[g,y];let o=t.create("text",[0,0,r.text],i);o.isDraggable=!b.current,o.on("down",function(c){m.current=[c.x,c.y],F.current=[...s.coords.scrCoords],l.current=!1,E.current=!0,D.current=!1,C.current||f({action:d.textFocused,args:{name:_}})}),o.on("hit",function(c){F.current=[...s.coords.scrCoords],l.current=!1,f({action:d.textFocused,args:{name:_}})}),o.on("up",function(c){l.current?(f({action:d.moveText,args:{x:h.current,y:p.current}}),l.current=!1):!D.current&&!C.current&&f({action:d.textClicked,args:{name:_}}),E.current=!1}),o.on("keyfocusout",function(c){l.current&&(f({action:d.moveText,args:{x:h.current,y:p.current}}),l.current=!1)}),o.on("drag",function(c){let x=c.type==="pointermove";(!x||Math.abs(c.x-m.current[0])>.1||Math.abs(c.y-m.current[1])>.1)&&(l.current=!0);let[N,T,U,X]=t.getBoundingBox(),Y=o.size[0]/t.unitX,j=o.size[1]/t.unitY,J=P.current[0],L=P.current[1],A=0;J==="middle"?A=-Y/2:J==="right"&&(A=-Y);let M=0;L==="middle"?M=-j/2:L==="top"&&(M=-j);let I=N+.04*(U-N)-A-Y,ee=U-.04*(U-N)-A,re=X+.04*(T-X)-M-j,te=T-.04*(T-X)-M;if(x){var W=t.origin.scrCoords;h.current=(F.current[1]+c.x-m.current[0]-W[1])/t.unitX,p.current=(W[2]-(F.current[2]+c.y-m.current[1]))/t.unitY}else h.current=s.X()+o.relativeCoords.usrCoords[1],p.current=s.Y()+o.relativeCoords.usrCoords[2];h.current=Math.min(ee,Math.max(I,h.current)),p.current=Math.min(te,Math.max(re,p.current)),f({action:d.moveText,args:{x:h.current,y:p.current,transient:!0,skippable:!0}}),o.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),s.coords.setCoordinates(JXG.COORDS_BY_USER,w.current)}),o.on("keydown",function(c){c.key==="Enter"&&(l.current&&(f({action:d.moveText,args:{x:h.current,y:p.current}}),l.current=!1),f({action:d.textClicked,args:{name:_}}))}),e.current=o,S.current=s,B.current=r.positionFromAnchor}function G(u){E.current&&(Math.abs(u.x-m.current[0])>.1||Math.abs(u.y-m.current[1])>.1)&&(D.current=!0)}function q(){e.current.off("drag"),e.current.off("down"),e.current.off("hit"),e.current.off("up"),e.current.off("keyfocusout"),e.current.off("keydown"),t.removeObject(e.current),e.current=null}if(t){let u;try{let a=$.fromAst(r.anchor);u=[a.get_component(0).evaluate_to_constant(),a.get_component(1).evaluate_to_constant()]}catch{u=[NaN,NaN]}if(w.current=u,e.current===null)Z();else{e.current.relativeCoords.setCoordinates(JXG.COORDS_BY_USER,[0,0]),S.current.coords.setCoordinates(JXG.COORDS_BY_USER,u),e.current.setText(r.text);let a=!r.hidden;if(Number.isFinite(u[0])&&Number.isFinite(u[1])){let y=e.current.visProp.visible!==a;e.current.visProp.visible=a,e.current.visPropCalc.visible=a,y&&e.current.setAttribute({visible:a})}else e.current.visProp.visible=!1,e.current.visPropCalc.visible=!1;let v=10*r.layer+K;e.current.visProp.layer!==v&&e.current.setAttribute({layer:v});let i=k==="dark"?r.selectedStyle.textColorDarkMode:r.selectedStyle.textColor,s=k==="dark"?r.selectedStyle.backgroundColorDarkMode:r.selectedStyle.backgroundColor,g="";if(s?g+=`background-color: ${s}`:g+="background-color: transparent",e.current.visProp.strokecolor!==i&&(e.current.visProp.strokecolor=i,e.current.visProp.highlightstrokecolor=i),e.current.visProp.cssstyle!==g&&(e.current.visProp.cssstyle=g,e.current.visProp.highlightcssstyle=g),e.current.visProp.highlight=!b.current,e.current.visProp.fixed=C.current,e.current.isDraggable=!b.current,e.current.needsUpdate=!0,r.positionFromAnchor!==B.current){let{anchorx:y,anchory:o}=z(r.positionFromAnchor);e.current.visProp.anchorx=y,e.current.visProp.anchory=o,P.current=[y,o],B.current=r.positionFromAnchor,e.current.fullUpdate()}else e.current.update();S.current.needsUpdate=!0,S.current.update(),t.updateRenderer()}return R.jsx("a",{name:O})}if(r.hidden)return null;let H=se(k,r.selectedStyle);return R.jsxs(R.Fragment,{children:[R.jsx("a",{name:O}),R.jsx("span",{id:O,style:H,children:r.text})]})});export{he as default};
