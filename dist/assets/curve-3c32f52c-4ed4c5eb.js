import{M as Te,u as Oe,r as l,h as Se,i as Me,k as w,j as P}from"./index-2b5c64d9.js";import{BoardContext as Fe,LINE_LAYER_OFFSET as Pe,VERTEX_LAYER_OFFSET as Z,CONTROL_POINT_LAYER_OFFSET as xe}from"./graph-6d43a295-5c8ba528.js";import"./css-ab4d83ca-d016d639.js";const Xe=Te.memo(function L($){let{name:k,id:O,SVs:e,actions:m,sourceOfUpdate:I,callAction:b}=Oe($);L.ignoreActionsWithoutCore=()=>!0;const o=l.useContext(Fe);let u=l.useRef(null),p=l.useRef(null),i=l.useRef(null),ee=l.useRef(null),U=l.useRef(null),j=l.useRef(null),W=l.useRef(null),z=l.useRef(!1),V=l.useRef(!1),se=l.useRef(null),S=l.useRef(null),B=l.useRef(null),Y=l.useRef(null),re=l.useRef(null),M=l.useRef(null),T=l.useRef(null),s=l.useRef([]),F=l.useRef(null),J=l.useRef(null),te=l.useRef(null),Q=l.useRef(null),D=l.useRef(!1),E=l.useRef(!1),ne=l.useRef(!1),oe=l.useRef([]),A=l.useRef([]);D.current=e.fixed,E.current=!e.draggable||e.fixLocation||e.fixed,ne.current=e.switchable&&!e.fixed,te.current=e.vectorControlDirections;let fe=l.useRef(null);fe.current=e.numericalThroughPoints;let de=l.useRef(null);de.current=e.numericalControlPoints;const he=Se(Me);l.useEffect(()=>()=>{u.current&&ue(),o&&o.off("move",ve)},[]),l.useEffect(()=>{o&&o.on("move",ve)},[o]);function pe(){if(e.curveType==="bezier"&&e.numericalThroughPoints.length<2)return null;let r=he==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;var t={name:e.labelForGraph,visible:!e.hidden,withLabel:e.labelForGraph!=="",fixed:D.current,layer:10*e.layer+Pe,strokeColor:r,strokeOpacity:e.selectedStyle.lineOpacity,strokeWidth:e.selectedStyle.lineWidth,dash:Ce(e.selectedStyle.lineStyle,e.dashed),highlight:!1,lineCap:"butt"};if(e.labelForGraph!==""){let c,f,h;e.labelPosition==="upperright"?(h="urt",f=[-5,-10],c="right"):e.labelPosition==="upperleft"?(h="ulft",f=[5,-10],c="left"):e.labelPosition==="lowerright"?(h="lrt",f=[-5,10],c="right"):e.labelPosition==="lowerleft"?(h="llft",f=[5,10],c="left"):e.labelPosition==="top"?(h="top",f=[0,-10],c="left"):e.labelPosition==="bottom"?(h="bot",f=[0,10],c="left"):e.labelPosition==="left"?(h="lft",f=[10,0],c="left"):(h="rt",f=[-10,0],c="right"),t.label={offset:f,position:h,anchorx:c,highlight:!1},e.labelHasLatex&&(t.label.useMathJax=!0),e.applyStyleToLabel?t.label.strokeColor=r:t.label.strokeColor="var(canvastext)"}else t.label={highlight:!1},e.labelHasLatex&&(t.label.useMathJax=!0);let v;if(e.curveType==="parameterization"){let c=w(e.fDefinitions[0]),f=w(e.fDefinitions[1]);v=o.create("curve",[c,f,e.parMin,e.parMax],t)}else if(e.curveType==="bezier"){let c=w(e.fDefinitions[0]),f=w(e.fDefinitions[1]);v=o.create("curve",[c,f,e.parMin,e.parMax],t)}else{let c=w(e.fDefinitions[0]);if(e.flipFunction){let f=e.graphYmin,h=e.graphYmax,g=Math.max(f-(h-f)*.1,e.parMin),_=Math.min(h+(h-f)*.1,e.parMax);v=o.create("curve",[c,ce=>ce,g,_],t)}else{let f=e.graphXmin,h=e.graphXmax,g=Math.max(f-(h-f)*.1,e.parMin),_=Math.min(h+(h-f)*.1,e.parMax);v=o.create("functiongraph",[c,g,_],t)}se.current=e.flipFunction}return ee.current=e.curveType,U.current=null,j.current=null,v.isDraggable=!1,v.on("up",function(c){!V.current&&!D.current&&(ne.current&&b({action:m.switchCurve}),b({action:m.curveClicked,args:{name:k}})),z.current=!1}),v.on("keydown",function(c){c.key==="Enter"&&(ne.current&&b({action:m.switchCurve}),b({action:m.curveClicked,args:{name:k}}))}),e.curveType==="bezier"?(o.on("up",ye),v.on("down",c=>{W.current=[c.x,c.y],z.current=!0,V.current=!1,x(),D.current||b({action:m.curveFocused,args:{name:k}})}),v.on("hit",function(c){x(),b({action:m.curveFocused,args:{name:k}})}),S.current={visible:!1,withLabel:!1,fixed:!0,strokeColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",layer:10*e.layer+Z,strokeWidth:1,highlightStrokeWidth:1},B.current={visible:!e.hidden,withLabel:!1,fixed:!1,fillColor:"none",strokeColor:"none",highlightFillColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",strokeWidth:1,highlightStrokeWidth:1,layer:10*e.layer+Z,size:3},Y.current={fillcolor:"var(--mainGray)",strokecolor:"var(--mainGray)"},re.current={fillcolor:"none",strokecolor:"none"},M.current={visible:!1,withLabel:!1,fixed:!1,fillColor:"var(--mainGray)",strokeColor:"var(--mainGray)",highlightFillColor:"var(--mainGray)",highlightStrokeColor:"var(--mainGray)",strokeWidth:1,highlightStrokeWidth:1,layer:10*e.layer+xe,size:2},E.current||(ge(),e.bezierControlsAlwaysVisible&&(ie(),ke()),o.updateRenderer(),T.current=e.numericalThroughPoints.length,Q.current=[...e.vectorControlDirections])):(v.on("down",function(c){W.current=[c.x,c.y],z.current=!0,V.current=!1,D.current||b({action:m.curveFocused,args:{name:k}})}),v.on("hit",function(c){b({action:m.curveFocused,args:{name:k}})})),v}function ve(r){z.current&&(Math.abs(r.x-W.current[0])>.1||Math.abs(r.y-W.current[1])>.1)&&(V.current=!0)}function ue(){o.off("up",ye),u.current.off("down"),u.current.off("up"),u.current.off("keydown"),o.removeObject(u.current),u.current=null,me()}function ge(){p.current=[],i.current=[],s.current=[];for(let r=0;r<e.numericalThroughPoints.length;r++){let t=o.create("point",[...e.numericalThroughPoints[r]],B.current);p.current.push(t);let v=o.create("point",[...e.numericalControlPoints[r][0]],M.current),c=o.create("point",[...e.numericalControlPoints[r][1]],M.current);i.current.push([v,c]);let f=o.create("segment",[t,v],S.current),h=o.create("segment",[t,c],S.current);s.current.push([f,h]),t.on("drag",g=>be(r)),t.on("down",g=>N(r,g)),t.on("hit",g=>N(r,g)),t.on("up",g=>H(r)),t.on("keyfocusout",g=>H(r)),v.on("drag",g=>q(r,0)),c.on("drag",g=>q(r,1)),v.on("down",x),c.on("down",x),f.on("down",x),h.on("down",x),v.on("up",g=>K(r,0)),c.on("up",g=>K(r,1))}F.current=[]}function me(){s.current.length>0&&(s.current.forEach(r=>r.forEach(t=>{t&&(t.off("down"),o.removeObject(t))})),s.current=[],i.current.forEach(r=>r.forEach(t=>{t&&(t.off("drag"),t.off("down"),t.off("up"),o.removeObject(t))})),i.current=[],p.current.forEach(r=>{r.off("drag"),r.off("down"),r.off("hit"),r.off("up"),r.off("keyfocusout"),o.removeObject(r)}),p.current=[])}function N(r,t){if(E.current)return;j.current=null,U.current=null;let v=t.type==="pointerdown";J.current=v,ie(),G(r),o.updateRenderer()}function be(r){j.current=r,oe.current[r]=[p.current[r].X(),p.current[r].Y()],b({action:m.moveThroughPoint,args:{throughPoint:oe.current[r],throughPointInd:r,transient:!0,skippable:!0}}),p.current[r].coords.setCoordinates(JXG.COORDS_BY_USER,fe.current[r]),o.updateInfobox(p.current[r])}function H(r){j.current===r&&b({action:m.moveThroughPoint,args:{throughPoint:oe.current[r],throughPointInd:r}})}function q(r,t){U.current=r+"_"+t,A.current[r]||(A.current[r]={}),A.current[r][t]=[i.current[r][t].X()-p.current[r].X(),i.current[r][t].Y()-p.current[r].Y()],b({action:m.moveControlVector,args:{controlVector:A.current[r][t],controlVectorInds:[r,t],transient:!0,skippable:!0}}),i.current[r][t].coords.setCoordinates(JXG.COORDS_BY_USER,[...de.current[r][t]]),o.updateInfobox(i.current[r][t])}function K(r,t){U.current===r+"_"+t&&b({action:m.moveControlVector,args:{controlVector:A.current[r][t],controlVectorInds:[r,t]}})}function ie(){for(let r of p.current){for(let t in Y.current)r.visProp[t]=Y.current[t];r.needsUpdate=!0,r.update()}}function Re(){for(let r of p.current){for(let t in re.current)r.visProp[t]=re.current[t];r.needsUpdate=!0,r.update()}}function we(){for(let r of i.current)for(let t of r)t&&(t.visProp.visible=!1,t.needsUpdate=!0,t.update());for(let r of s.current)for(let t of r)t&&(t.visProp.visible=!1,t.needsUpdate=!0,t.update());F.current=[]}function ke(){for(let r in i.current)G(r)}function ye(){E.current||(J.current!==!0&&!e.bezierControlsAlwaysVisible&&(Re(),we(),o.updateRenderer()),J.current=!1)}function G(r){if(!e.hiddenControls[r]){if(i.current[r][0]){let t=(r>0||e.extrapolateBackward)&&["symmetric","both","previous"].includes(te.current[r]);i.current[r][0].visProp.visible=t,i.current[r][0].visPropCalc.visible=t,i.current[r][0].needsUpdate=!0,i.current[r][0].update(),s.current[r][0].visProp.visible=t,s.current[r][0].visPropCalc.visible=t,s.current[r][0].needsUpdate=!0,s.current[r][0].update()}if(i.current[r][1]){let t=(r<p.current.length-1||e.extrapolateForward)&&["symmetric","both","next"].includes(te.current[r]);i.current[r][1].visProp.visible=t,i.current[r][1].visPropCalc.visible=t,i.current[r][1].needsUpdate=!0,i.current[r][1].update(),s.current[r][1].visProp.visible=t,s.current[r][1].visPropCalc.visible=t,s.current[r][1].needsUpdate=!0,s.current[r][1].update()}F.current[r]=!0}}function x(){E.current||(j.current=null,U.current=null,J.current=!0,ie(),o.updateRenderer())}if(o)if(!u.current)u.current=pe();else if(e.curveType==="bezier"&&e.numericalThroughPoints.length<2)ue();else if(ee.current!==e.curveType||ee.current==="function"&&se.current!==e.flipFunction)ue(),u.current=pe(),o.updateQuality===o.BOARD_QUALITY_LOW&&(o.itemsRenderedLowQuality[O]=u.current);else{o.updateQuality===o.BOARD_QUALITY_LOW&&(o.itemsRenderedLowQuality[O]=u.current);let r=!e.hidden;u.current.name=e.labelForGraph,u.current.visProp.visible=r,u.current.visPropCalc.visible=r;let t=10*e.layer+Pe,v=u.current.visProp.layer!==t,c,f,h;v&&(c=10*e.layer+Z,f=10*e.layer+Z,h=10*e.layer+xe,u.current.setAttribute({layer:t}),S.current.layer=c,B.current.layer=f,M.current.layer=h);let g=he==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;u.current.visProp.strokecolor!==g&&(u.current.visProp.strokecolor=g,u.current.visProp.highlightstrokecolor=g),u.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(u.current.visProp.strokeopacity=e.selectedStyle.lineOpacity);let _=Ce(e.selectedStyle.lineStyle,e.dashed);if(u.current.visProp.dash!==_&&(u.current.visProp.dash=_),u.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(u.current.visProp.strokewidth=e.selectedStyle.lineWidth),e.curveType==="parameterization"){let n=w(e.fDefinitions[0]),d=w(e.fDefinitions[1]);u.current.X=n,u.current.Y=d,u.current.minX=()=>e.parMin,u.current.maxX=()=>e.parMax}else if(e.curveType==="bezier")u.current.X=w(e.fDefinitions[0]),u.current.Y=w(e.fDefinitions[1]),u.current.minX=()=>e.parMin,u.current.maxX=()=>e.parMax;else{let n=w(e.fDefinitions[0]);if(e.flipFunction){u.current.X=n;let d=e.graphYmin,a=e.graphYmax,y=Math.max(d-(a-d)*.1,e.parMin),C=Math.min(a+(a-d)*.1,e.parMax);u.current.minX=()=>y,u.current.maxX=()=>C}else{u.current.Y=n;let d=e.graphXmin,a=e.graphXmax,y=Math.max(d-(a-d)*.1,e.parMin),C=Math.min(a+(a-d)*.1,e.parMax);u.current.minX=()=>y,u.current.maxX=()=>C}}if(u.current.visProp.fixed=D.current,u.current.needsUpdate=!0,u.current.updateCurve(),u.current.hasLabel&&(u.current.label.needsUpdate=!0,u.current.label.visPropCalc.visible=e.labelForGraph!=="",e.applyStyleToLabel?u.current.label.visProp.strokecolor=g:u.current.label.visProp.strokecolor="var(canvastext)",u.current.label.update()),e.curveType!=="bezier")return o.updateRenderer(),P.jsx(P.Fragment,{children:P.jsx("a",{name:O})});if(E.current)return s.current.length>0&&me(),o.updateRenderer(),P.jsx(P.Fragment,{children:P.jsx("a",{name:O})});if(s.current.length===0)return ge(),T.current=e.numericalThroughPoints.length,Q.current=[...e.vectorControlDirections],o.updateRenderer(),P.jsx(P.Fragment,{children:P.jsx("a",{name:O})});if(e.numericalThroughPoints.length>T.current){let n=T.current-1,d=Object.assign({},B.current);p.current[n].visProp.fillcolor===Y.current.fillcolor&&Object.assign(d,Y.current);for(let a=T.current;a<e.numericalThroughPoints.length;a++){let y=o.create("point",[...e.numericalThroughPoints[a]],d);p.current.push(y);let C=o.create("point",[...e.numericalControlPoints[a][0]],M.current),X=o.create("point",[...e.numericalControlPoints[a][1]],M.current);i.current.push([C,X]);let le=o.create("segment",[y,C],S.current),ae=o.create("segment",[y,X],S.current);s.current.push([le,ae]),C.visProp.visible=!1,le.visProp.visible=!1,X.visProp.visible=!1,ae.visProp.visible=!1,y.on("drag",R=>be(a)),y.on("down",R=>N(a,R)),y.on("hit",R=>N(a,R)),y.on("up",R=>H(a)),y.on("keyfocusout",R=>H(a)),C.on("drag",R=>q(a,0)),C.on("down",x),C.on("up",R=>K(a,0)),X.on("drag",R=>q(a,1)),X.on("down",x),X.on("up",R=>K(a,1)),le.on("down",x),ae.on("down",x)}F.current[n]&&G(n)}else if(e.numericalThroughPoints.length<T.current){for(let d=T.current-1;d>=e.numericalThroughPoints.length;d--){s.current[d][0].off("down"),s.current[d][1].off("down"),o.removeObject(s.current[d][0]),o.removeObject(s.current[d][1]),s.current.pop(),i.current[d][0].off("drag"),i.current[d][0].off("down"),i.current[d][0].off("up"),i.current[d][1].off("drag"),i.current[d][1].off("down"),i.current[d][1].off("up"),o.removeObject(i.current[d][0]),o.removeObject(i.current[d][1]),i.current.pop();let a=p.current.pop();a.off("drag"),a.off("down"),a.off("up"),a.off("hit"),a.off("keyfocusout"),o.removeObject(a)}let n=e.numericalThroughPoints.length-1;F.current[n]&&G(n)}let ce=Math.min(e.numericalThroughPoints.length,T.current);for(let n=0;n<ce;n++)Q.current[n]!==e.vectorControlDirections[n]&&F.current[n]&&G(n),v&&(p.current[n].setAttribute({layer:f}),s.current[n][0].setAttribute({layer:c}),i.current[n][0].setAttribute({layer:h}),s.current[n][1].setAttribute({layer:c}),i.current[n][1].setAttribute({layer:h})),p.current[n].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalThroughPoints[n]]),p.current[n].needsUpdate=!0,p.current[n].update(),i.current[n][0].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalControlPoints[n][0]]),i.current[n][0].needsUpdate=!0,i.current[n][0].update(),s.current[n][0].needsUpdate=!0,s.current[n][0].update(),i.current[n][1].coords.setCoordinates(JXG.COORDS_BY_USER,[...e.numericalControlPoints[n][1]]),i.current[n][1].needsUpdate=!0,i.current[n][1].update(),s.current[n][1].needsUpdate=!0,s.current[n][1].update();for(let n=0;n<e.numericalThroughPoints.length;n++)p.current[n].visProp.visible=!e.hidden,p.current[n].visPropCalc.visible=!e.hidden;if(I.sourceInformation&&k in I.sourceInformation){let n=I.sourceInformation[k].throughPointMoved;n!==void 0?o.updateInfobox(p.current[n]):(n=I.sourceInformation[k].controlVectorMoved,n!==void 0&&o.updateInfobox(i.current[n[0]][n[1]]))}T.current=e.numericalThroughPoints.length,Q.current=[...e.vectorControlDirections],o.updateRenderer()}return e.hidden?null:P.jsx(P.Fragment,{children:P.jsx("a",{name:O})})});function Ce(L,$){return L==="dashed"||$?2:L==="solid"?0:L==="dotted"?1:0}export{Xe as default};
