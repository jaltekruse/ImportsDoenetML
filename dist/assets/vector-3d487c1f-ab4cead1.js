import{M as ee,u as re,r as i,h as te,i as ne,j as C,t as ce,a as oe}from"./index-2b5c64d9.js";import{BoardContext as ue,LINE_LAYER_OFFSET as N,VERTEX_LAYER_OFFSET as z}from"./graph-6d43a295-5c8ba528.js";import"./css-ab4d83ca-d016d639.js";const ae=ee.memo(function w(q){let{name:h,id:A,SVs:e,actions:o,sourceOfUpdate:Y,callAction:u}=re(q);w.ignoreActionsWithoutCore=()=>!0;const l=i.useContext(ue);let r=i.useRef({}),d=i.useRef({}),f=i.useRef({}),m=i.useRef(null),M=i.useRef(null),R=i.useRef(!1),E=i.useRef(!1),n=i.useRef(!1),c=i.useRef(!1),j=i.useRef(null),b=i.useRef(null),k=i.useRef(null),I=i.useRef(null),U=i.useRef(null),O=i.useRef(!1),F=i.useRef(!1),_=i.useRef(!0),L=i.useRef(!0);U.current=e.numericalEndpoints,O.current=e.fixed,F.current=!e.draggable||e.fixLocation||e.fixed,L.current=e.tailDraggable&&!e.fixed&&!e.fixLocation,_.current=e.headDraggable&&!e.fixed&&!e.fixLocation;const X=te(ne);i.useEffect(()=>()=>{Object.keys(r.current).length!==0&&J(),l&&l.off("move",W)},[]),i.useEffect(()=>{l&&l.on("move",W)},[l]);function H(){if(e.numericalEndpoints.length!==2||e.numericalEndpoints.some(t=>t.length!==2)){r.current={},d.current={},f.current={};return}let s=10*e.layer+N,a=10*e.layer+z,g=X==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;var y={name:e.labelForGraph,visible:!e.hidden,withLabel:e.labelForGraph!=="",fixed:O.current,layer:s,strokeColor:g,strokeOpacity:e.selectedStyle.lineOpacity,highlightStrokeColor:g,highlightStrokeOpacity:e.selectedStyle.lineOpacity*.5,strokeWidth:e.selectedStyle.lineWidth,highlightStrokeWidth:e.selectedStyle.lineWidth,dash:$(e.selectedStyle.lineStyle),highlight:!F.current,lastArrow:{type:1,size:3,highlightSize:3}};let P=[[...e.numericalEndpoints[0]],[...e.numericalEndpoints[1]]],x=Object.assign({},y);Object.assign(x,{withLabel:!1,fixed:!1,highlight:!0,fillColor:"none",strokeColor:"none",highlightStrokeColor:"none",highlightFillColor:getComputedStyle(document.documentElement).getPropertyValue("--mainGray"),layer:a});let D=Object.assign({},x),V=L.current&&!e.hidden;D.visible=V;let p=l.create("point",P[0],D),B=Object.assign({},x),K=_.current&&!e.hidden;B.visible=K;let S=l.create("point",P[1],B);y.label={highlight:!1},e.labelHasLatex&&(y.label.useMathJax=!0),e.applyStyleToLabel?y.label.strokeColor=g:y.label.strokeColor="var(--canvastext)";let v=l.create("arrow",[p,S],y);v.isDraggable=!F.current,p.on("drag",t=>G(t,0)),S.on("drag",t=>G(t,1)),v.on("drag",t=>G(t,-1)),p.on("up",t=>{!n.current&&c.current?u({action:o.moveVector,args:{tailcoords:k.current}}):!E.current&&!O.current&&u({action:o.vectorClicked,args:{name:h}}),j.current=null,R.current=!1}),S.on("up",t=>{n.current&&!c.current?u({action:o.moveVector,args:{headcoords:b.current}}):!E.current&&!O.current&&u({action:o.vectorClicked,args:{name:h}}),j.current=null,R.current=!1}),v.on("up",t=>{n.current&&c.current?u({action:o.moveVector,args:{headcoords:b.current,tailcoords:k.current}}):!E.current&&j.current===null&&!O.current&&u({action:o.vectorClicked,args:{name:h}}),R.current=!1}),p.on("keyfocusout",t=>{!n.current&&c.current&&u({action:o.moveVector,args:{tailcoords:k.current}}),n.current=!1,c.current=!1}),S.on("keyfocusout",t=>{n.current&&!c.current&&u({action:o.moveVector,args:{headcoords:b.current}}),n.current=!1,c.current=!1}),v.on("keyfocusout",t=>{n.current&&c.current&&u({action:o.moveVector,args:{headcoords:b.current,tailcoords:k.current}}),n.current=!1,c.current=!1}),p.on("down",function(t){n.current=!1,c.current=!1,m.current=[t.x,t.y],j.current=1,R.current=!0,E.current=!1,L.current&&u({action:o.vectorFocused,args:{name:h}})}),p.on("hit",function(t){n.current=!1,c.current=!1,u({action:o.vectorFocused,args:{name:h}})}),S.on("down",function(t){n.current=!1,c.current=!1,m.current=[t.x,t.y],j.current=2,R.current=!0,E.current=!1,_.current&&u({action:o.vectorFocused,args:{name:h}})}),S.on("hit",function(t){n.current=!1,c.current=!1,u({action:o.vectorFocused,args:{name:h}})}),v.on("down",function(t){n.current=!1,c.current=!1,m.current=[t.x,t.y],M.current=[[...v.point1.coords.scrCoords],[...v.point2.coords.scrCoords]],R.current=!0,E.current=!1,O.current||u({action:o.vectorFocused,args:{name:h}})}),v.on("hit",function(t){n.current=!1,c.current=!1,u({action:o.vectorFocused,args:{name:h}})}),p.on("keydown",t=>{t.key==="Enter"&&(!n.current&&c.current&&u({action:o.moveVector,args:{tailcoords:k.current}}),n.current=!1,c.current=!1,u({action:o.vectorClicked,args:{name:h}}))}),S.on("keydown",t=>{t.key==="Enter"&&(n.current&&!c.current&&u({action:o.moveVector,args:{headcoords:b.current}}),n.current=!1,c.current=!1,u({action:o.vectorClicked,args:{name:h}}))}),v.on("keydown",t=>{t.key==="Enter"&&(n.current&&c.current&&u({action:o.moveVector,args:{headcoords:b.current,tailcoords:k.current}}),n.current=!1,c.current=!1,u({action:o.vectorClicked,args:{name:h}}))}),r.current=v,d.current=p,f.current=S}function W(s){R.current&&(Math.abs(s.x-m.current[0])>.1||Math.abs(s.y-m.current[1])>.1)&&(E.current=!0)}function G(s,a){if(s.type!=="pointermove"||Math.abs(s.x-m.current[0])>.1||Math.abs(s.y-m.current[1])>.1){a===0?c.current=!0:a===1?n.current=!0:(n.current=!0,c.current=!0);let g={transient:!0,skippable:!0};n.current&&(a===-1?b.current=T(s,1):b.current=[r.current.point2.X(),r.current.point2.Y()],g.headcoords=b.current),c.current&&(a===-1?k.current=T(s,0):k.current=[r.current.point1.X(),r.current.point1.Y()],g.tailcoords=k.current),(a===0||a===1)&&(g.sourceDetails={vertex:a}),u({action:o.moveVector,args:g}),r.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,U.current[0]),r.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,U.current[1]),a===0?l.updateInfobox(d.current):a===1&&l.updateInfobox(f.current)}}function J(){r.current.off("drag"),r.current.off("down"),r.current.off("hit"),r.current.off("up"),r.current.off("keyfocusout"),r.current.off("keydown"),l.removeObject(r.current),r.current={},d.current.off("drag"),d.current.off("down"),d.current.off("hit"),d.current.off("up"),d.current.off("keyfocusout"),d.current.off("keydown"),l.removeObject(d.current),d.current={},f.current.off("drag"),f.current.off("down"),f.current.off("hit"),f.current.off("up"),f.current.off("keyfocusout"),f.current.off("keydown"),l.removeObject(f.current),f.current={}}function T(s,a){if(s.type==="pointermove"){var g=l.origin.scrCoords;let y=(M.current[a][1]+s.x-m.current[0]-g[1])/l.unitX,P=(g[2]-(M.current[a][2]+s.y-m.current[1]))/l.unitY;return[y,P]}else return a==0?[r.current.point1.X(),r.current.point1.Y()]:[r.current.point2.X(),r.current.point2.Y()]}if(l){if(Object.keys(r.current).length===0)H();else if(e.numericalEndpoints.length!==2||e.numericalEndpoints.some(s=>s.length!==2))J();else{let s=!0;for(let p of[e.numericalEndpoints[0],e.numericalEndpoints[1]])Number.isFinite(p[0])||(s=!1),Number.isFinite(p[1])||(s=!1);r.current.point1.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalEndpoints[0]),r.current.point2.coords.setCoordinates(JXG.COORDS_BY_USER,e.numericalEndpoints[1]);let a=!e.hidden&&s,g=L.current&&a,y=_.current&&a;if(r.current.visProp.fixed=O.current,r.current.visProp.highlight=!F.current,r.current.isDraggable=!F.current,r.current.visProp.visible=a,r.current.visPropCalc.visible=a,d.current.visProp.visible=g,d.current.visPropCalc.visible=g,f.current.visProp.visible=y,f.current.visPropCalc.visible=y,Y.sourceInformation&&h in Y.sourceInformation){let p=Y.sourceInformation[h];p.vertex===0?l.updateInfobox(d.current):p.vertex===1&&l.updateInfobox(f.current)}let P=10*e.layer+N;if(r.current.visProp.layer!==P){let p=10*e.layer+z;r.current.setAttribute({layer:P}),d.current.setAttribute({layer:p}),f.current.setAttribute({layer:p})}let x=X==="dark"?e.selectedStyle.lineColorDarkMode:e.selectedStyle.lineColor;r.current.visProp.strokecolor!==x&&(r.current.visProp.strokecolor=x,r.current.visProp.highlightstrokecolor=x),r.current.visProp.strokewidth!==e.selectedStyle.lineWidth&&(r.current.visProp.strokewidth=e.selectedStyle.lineWidth,r.current.visProp.highlightstrokewidth=e.selectedStyle.lineWidth),r.current.visProp.strokeopacity!==e.selectedStyle.lineOpacity&&(r.current.visProp.strokeopacity=e.selectedStyle.lineOpacity,r.current.visProp.highlightstrokeopacity=e.selectedStyle.lineOpacity*.5);let D=$(e.selectedStyle.lineStyle);r.current.visProp.dash!==D&&(r.current.visProp.dash=D),r.current.name=e.labelForGraph;let V=e.labelForGraph!=="";V!=I.current&&(r.current.setAttribute({withlabel:V}),I.current=V),r.current.needsUpdate=!0,r.current.update(),r.current.hasLabel&&(e.applyStyleToLabel?r.current.label.visProp.strokecolor=x:r.current.label.visProp.strokecolor="var(--canvastext)",r.current.label.needsUpdate=!0,r.current.label.update()),d.current.needsUpdate=!0,d.current.update(),f.current.needsUpdate=!0,f.current.update(),l.updateRenderer()}return C.jsx(C.Fragment,{children:C.jsx("a",{name:A})})}if(e.hidden)return null;let Q="\\("+e.latex+"\\)",Z=ce(X,e.selectedStyle);return C.jsxs(C.Fragment,{children:[C.jsx("a",{name:A}),C.jsx("span",{id:A,style:Z,children:C.jsx(oe,{hideUntilTypeset:"first",inline:!0,dynamic:!0,children:Q})})]})});function $(w){return w==="solid"?0:w==="dashed"?2:w==="dotted"?1:0}export{ae as default};
